---

- name: "MEDIUM | UBTU-18-010002 | PATCH | The Ubuntu operating system must initiate session audits at system startup."
  block:
      - name: "MEDIUM | UBTU-18-010002 | AUDIT | The Ubuntu operating system must initiate session audits at system startup. | Get GRUB_CMDLINE_LINUX"
        shell: grep "GRUB_CMDLINE_LINUX=" /etc/default/grub | cut -f2 -d'"'
        changed_when: false
        failed_when: false
        register: ubtu_18_010002_cmdline_settings

      - name: "MEDIUM | UBTU-18-010002 | PATCH | The Ubuntu operating system must initiate session audits at system startup. | Add setting if audit doesn't exist"
        lineinfile:
            path: /etc/default/grub
            regexp: '^GRUB_CMDLINE_LINUX='
            line: 'GRUB_CMDLINE_LINUX="{{ ubtu_18_010002_cmdline_settings.stdout }} audit=1"'
        notify: update grub
        when: "'audit=' not in ubtu_18_010002_cmdline_settings.stdout"

      - name: "MEDIUM | UBTU-18-010002 | PATCH | The Ubuntu operating system must initiate session audits at system startup. | Add setting if audit exists"
        replace:
            path: /etc/default/grub
            regexp: 'audit=([0-9]+)'
            replace: 'audit=1'
        notify: update grub
        when: "'audit=' in ubtu_18_010002_cmdline_settings.stdout"
  when:
      - ubtu_18_010002
  tags:
      - UBTU-18-010002
      - CAT2
      - CCI-001464
      - SRG-OS-000254-GPOS-00095
      - SV-219149r610963_rule
      - V-219149
      - grub

- name: "MEDIUM | UBTU-18-010003 | AUDIT | Ubuntu operating systems handling data requiring data at rest protections must employ cryptographic mechanisms to prevent unauthorized disclosure and modification of the information at rest."
  block:
      - name: "MEDIUM | UBTU-18-010003 | AUDIT | Ubuntu operating systems handling data requiring data at rest protections must employ cryptographic mechanisms to prevent unauthorized disclosure and modification of the information at rest. | Get encrypted partitions"
        shell: more /etc/crypttab | sed 1d
        changed_when: false
        failed_when: false
        register: ubtu_18_010003_crypttab_status

      - name: "MEDIUM | UBTU-18-010003 | AUDIT | Ubuntu operating systems handling data requiring data at rest protections must employ cryptographic mechanisms to prevent unauthorized disclosure and modification of the information at rest. | Alert no partitions are encrypted"
        debug:
            msg:
                - "Warning!! There no encrypted partitions. Please make sure all permenant partitions are encrypted"
        when: ubtu_18_010003_crypttab_status.stdout | length == 0

      - name: "MEDIUM | UBTU-18-010003 | AUDIT | Ubuntu operating systems handling data requiring data at rest protections must employ cryptographic mechanisms to prevent unauthorized disclosure and modification of the information at rest. | Alert no partitions are encrypted"
        debug:
            msg:
                - "Warning!! Please review that no permenant partitions are missing. All permenant partitions need to be encrypted"
                - "{{ ubtu_18_010003_crypttab_status.stdout_lines }}"
        when: ubtu_18_010003_crypttab_status.stdout | length > 0
  when:
      - ubtu_18_010003
  tags:
      - UBTU-18-010003
      - CAT2
      - CCI-001199
      - CCI-002475
      - CCI-002476
      - SRG-OS-000185-GPOS-00079
      - SV-219150r610963_rule
      - V-219150
      - encryption
      - mounts

- name: "MEDIUM | UBTU-18-010016 | PATCH | Advance package Tool (APT) must be configured to prevent the installation of patches, service packs, device drivers, or Ubuntu operating system components without verification they have been digitally signed using a certificate that is recognized and approved by the organization."
  block:
      - name: "MEDIUM | UBTU-18-010016 | AUDIT | Advance package Tool (APT) must be configured to prevent the installation of patches, service packs, device drivers, or Ubuntu operating system components without verification they have been digitally signed using a certificate that is recognized and approved by the organization. | Find AllowUnauthenticated true"
        shell: "grep 'AllowUnauthenticated \"true\"' /etc/apt/apt.conf.d/* | cut -d: -f1"
        changed_when: false
        failed_when: false
        register: ubtu_18_010016_apt_allowunauthenticated_status

      - name: "MEDIUM | UBTU-18-010016 | PATCH | Advance package Tool (APT) must be configured to prevent the installation of patches, service packs, device drivers, or Ubuntu operating system components without verification they have been digitally signed using a certificate that is recognized and approved by the organization. | Fix AllowUnauthenticated to false"
        replace:
            path: "{{ item }}"
            regexp: 'AllowUnauthenticated "true"'
            replace: 'AllowUnauthenticated "false"'
        with_items:
            - "{{ ubtu_18_010016_apt_allowunauthenticated_status.stdout_lines }}"
        when: ubtu_18_010016_apt_allowunauthenticated_status.stdout | length > 0
  when:
      - ubtu_18_010016
  tags:
      - UBTU-18-010016
      - CAT2
      - CCI-001749
      - SRG-OS-000366-GPOS-00153
      - SV-219155r610963_rule
      - V-219155
      - apt

- name: "MEDIUM | UBTU-18-010017 | PATCH | The Ubuntu operating system must be configured so that Advance package Tool (APT) removes all software components after updated versions have been installed."
  block:
      - name: "MEDIUM | UBTU-18-010017 | AUDIT | The Ubuntu operating system must be configured so that Advance package Tool (APT) removes all software components after updated versions have been installed. | Find Remove-Unused-Kernel-Packages"
        shell: "grep -i 'remove-unused-kernel-packages \"false\"' /etc/apt/apt.conf.d/* | cut -d: -f1"
        changed_when: false
        failed_when: false
        register: ubtu_18_010017_remove_unused_kernel_packages_status

      - name: "MEDIUM | UBTU-18-010017 | AUDIT | The Ubuntu operating system must be configured so that Advance package Tool (APT) removes all software components after updated versions have been installed. | Find Remove-Unused-Dependencies"
        shell: "grep -i 'remove-unused-dependencies \"false\"' /etc/apt/apt.conf.d/* | cut -d: -f1"
        changed_when: false
        failed_when: false
        register: ubtu_18_010017_remove_unused_dependencies_status

      - name: "MEDIUM | UBTU-18-010017 | PATCH | The Ubuntu operating system must be configured so that Advance package Tool (APT) removes all software components after updated versions have been installed. | Set Remove-Unused-Kernel-Packages"
        lineinfile:
            path: "{{ item.path }}"
            regexp: "{{ item.regexp }}"
            line: "{{ item.line }}"
            create: true
            mode: 644
            owner: root
            group: root
        with_items:
            - { path: "{{ (ubtu_18_010017_remove_unused_kernel_packages_status.stdout | length == 0 ) | ternary('/etc/apt/apt.conf.d/50unattended-upgrades',ubtu_18_010017_remove_unused_kernel_packages_status.stdout) }}", regexp: 'Unattended-Upgrade::Remove-Unused-Kernel-Packages', line: 'Unattended-Upgrade::Remove-Unused-Kernel-Packages "true";' }
            - { path: "{{ (ubtu_18_010017_remove_unused_dependencies_status.stdout | length == 0 ) | ternary('/etc/apt/apt.conf.d/50unattended-upgrades',ubtu_18_010017_remove_unused_dependencies_status.stdout) }}", regexp: 'Unattended-Upgrade::Remove-Unused-Dependencies', line: 'Unattended-Upgrade::Remove-Unused-Dependencies "true";' }
        loop_control:
            label: "{{ item.line }}"
  when:
      - ubtu_18_010017
  tags:
      - UBTU-18-010017
      - CAT2
      - CCI-002617
      - SRG-OS-000437-GPOS-00194
      - SV-219156r610963_rule
      - V-219156
      - apt

# There is no mfetp package available. The McAfee instructions have you download the installer from their portal. This package may no longer be available
# - name: "MEDIUM | UBTU-18-010021 | PATCH | The Ubuntu operating system must deploy Endpoint Security for Linux Threat Prevention (ENSLTP)."
#   package:
#       name: mfetp
#       state: present
#   when:
#       - ubtu_18_010021
#       - '"mfetp" not in ansible_facts.packages'
#   tags:
#       - UBTU-18-010021
#       - CAT2
#       - CCI-001233
#       - SRG-OS-000191-GPOS-00080
#       - SV-219159r610963_rule
#       - V-219159
#       - ensltp

- name: "MEDIUM | UBTU-18-010022 | PATCH | The Ubuntu operating system must be configured to preserve log records from failure events."
  service:
      name: rsyslog
      state: started
      enabled: true
  when:
      - ubtu_18_010022
  tags:
      - UBTU-18-010022
      - CAT2
      - CCI-001665
      - SRG-OS-000269-GPOS-00103
      - SV-219160r610963_rule
      - V-219160
      - rsyslog

- name: "MEDIUM | UBTU-18-010023 | PATCH | The Ubuntu operating system must have an application firewall installed in order to control remote access methods."
  package:
      name: ufw
      state: present
  when:
      - ubtu_18_010023
  tags:
      - UBTU-18-010023
      - CAT2
      - CCI-002314
      - SRG-OS-000297-GPOS-00115
      - SV-219161r610963_rule
      - V-219161
      - ufw
      - firewall

- name: "MEDIUM | UBTU-18-010033 | PATCH | The Ubuntu operating system must be configured so that three consecutive invalid logon attempts by a user automatically locks the account until released by an administrator."
  block:
      - name: "MEDIUM | UBTU-18-010033 | AUDIT | The Ubuntu operating system must be configured so that three consecutive invalid logon attempts by a user automatically locks the account until released by an administrator. | Find pam_faillock.so authfail"
        shell: 'grep "auth.*\[default=die\].*pam_faillock.so" /etc/pam.d/common-auth'
        changed_when: false
        failed_when: false
        register: ubtu_18_010033_authfail_status

      - name: "MEDIUM | UBTU-18-010033 | AUDIT | The Ubuntu operating system must be configured so that three consecutive invalid logon attempts by a user automatically locks the account until released by an administrator. | Find pam_faillock.so authsucc"
        shell: grep "auth.*sufficient.*pam_faillock.so" /etc/pam.d/common-auth
        changed_when: false
        failed_when: false
        register: ubtu_18_010033_authsucc_status

      - name: "MEDIUM | UBTU-18-010033 | PATCH | The Ubuntu operating system must be configured so that three consecutive invalid logon attempts by a user automatically locks the account until released by an administrator. | Set if authsucc doesn't exist"
        pamd:
            name: common-auth
            type: "{{ ubtu18stig_pamd_faillock.type }}"
            control: "{{ ubtu18stig_pamd_faillock.control }}"
            module_path: "{{ ubtu18stig_pamd_faillock.module_path }}"
            new_type: auth
            new_control: sufficient
            new_module_path: pam_faillock.so
            module_arguments: authsucc
            state: "{{ ubtu18stig_pamd_faillock.state }}"
        when: ubtu_18_010033_authsucc_status.stdout | length == 0

      - name: "MEDIUM | UBTU-18-010033 | PATCH | The Ubuntu operating system must be configured so that three consecutive invalid logon attempts by a user automatically locks the account until released by an administrator. | Set if authfail doesn't exist"
        pamd:
            name: common-auth
            type: "{{ ubtu18stig_pamd_faillock.type }}"
            control: "{{ ubtu18stig_pamd_faillock.control }}"
            module_path: "{{ ubtu18stig_pamd_faillock.module_path }}"
            new_type: auth
            new_control: "[default=die]"
            new_module_path: pam_faillock.so
            module_arguments: authfail
            state: "{{ ubtu18stig_pamd_faillock.state }}"
        when: ubtu_18_010033_authfail_status.stdout | length == 0

      - name: "MEDIUM | UBTU-18-010033 | PATCH | The Ubuntu operating system must be configured so that three consecutive invalid logon attempts by a user automatically locks the account until released by an administrator. | Set authsucc does exist"
        pamd:
            name: common-auth
            type: auth
            control: sufficient
            module_path: pam_faillock.so
            module_arguments: authsucc
            state: args_present
        when: ubtu_18_010033_authsucc_status.stdout | length > 0

      - name: "MEDIUM | UBTU-18-010033 | PATCH | The Ubuntu operating system must be configured so that three consecutive invalid logon attempts by a user automatically locks the account until released by an administrator. | Set if authfail does exist"
        pamd:
            name: common-auth
            type: auth
            control: "[default=die]"
            module_path: pam_faillock.so
            module_arguments: authfail
            state: args_present
        when: ubtu_18_010033_authfail_status.stdout | length > 0

      - name: "MEDIUM | UBTU-18-010033 | PATCH | The Ubuntu operating system must be configured so that three consecutive invalid logon attempts by a user automatically locks the account until released by an administrator. | Update faillock.conf"
        lineinfile:
            path: /etc/security/faillock.conf
            regexp: "{{ item.regexp }}"
            line: "{{ item.line }}"
        with_items:
            - { regexp: '^#.*audit', line: audit }
            - { regexp: '^#.*silent', line: silent }
            - { regexp: '^deny.*=|^#.*deny.*=', line: "deny = {{ ubtu18stig_pamd_faillock.deny }}" }
            - { regexp: '^fail_interval.*=|^#.*fail_interval.*=', line: "fail_interval = {{ ubtu18stig_pamd_faillock.fail_interval }}" }
            - { regexp: '^unlock_time.*=|^#.*unlock_time.*=', line: "unlock_time = 0" }
  when:
      - ubtu_18_010033
  tags:
      - UBTU-18-010033
      - CAT2
      - CCI-000044
      - CCI-002238
      - SRG-OS-000021-GPOS-00005
      - SV-219166r802355_rule
      - V-219166
      - pamd

- name: "MEDIUM | UBTU-18-010035 | PATCH | The Ubuntu operating system must display the Standard Mandatory DoD Notice and Consent Banner before granting local access to the system via a graphical user logon. | Set banner settings"
  lineinfile:
      path: /etc/gdm3/greeter.dconf-defaults
      regexp: "{{ item.regexp }}"
      line: "{{ item.line }}"
      insertafter: "{{ item.insertafter }}"
      create: true
      owner: root
      group: root
      mode: 0644
  notify:
      - reload gdm
      - dconf update
  with_items:
      - { regexp: '\[org\/gnome\/login-screen\]', line: '[org/gnome/login-screen]', insertafter: EOF }
      - { regexp: 'banner-message-enable', line: 'banner-message-enable=true', insertafter: '\[org\/gnome\/login-screen\]'}
      - { regexp: 'banner-message-text', line: 'banner-message-text={{ ubtu18cis_warning_banner }}', insertafter: 'banner-message-enable' }
  loop_control:
      label: "{{ item.regexp }}"
  when:
      - ubtu_18_010035
      - ubtu18cis_desktop_required
  tags:
      - UBTU-18-010035
      - CAT2
      - CCI-000050
      - SRG-OS-000024-GPOS-00007
      - SV-219167r610963_rule
      - V-219167
      - banner

- name: "MEDIUM | UBTU-18-010036 | PATCH | The Ubuntu operating system must prevent direct login into the root account."
  user:
      name: root
      password_lock: true
  when:
      - ubtu_18_010036
  tags:
      - UBTU-18-010036
      - CAT2
      - CCI-000770
      - SRG-OS-000109-GPOS-00056
      - SV-219168r610963_rule
      - V-219168
      - accounts

- name: "MEDIUM | UBTU-18-010038 | PATCH | The Ubuntu operating system must display the Standard Mandatory DoD Notice and Consent Banner before granting any publically accessible connection to the system."
  block:
      - name: "MEDIUM | UBTU-18-010038 | PATCH | The Ubuntu operating system must display the Standard Mandatory DoD Notice and Consent Banner before granting any publically accessible connection to the system. | Uncomment banner keyword and set banner path"
        lineinfile:
            path: /etc/ssh/sshd_config
            regexp: '(?i)^#?Banner'
            line: Banner /etc/issue
        when:
            - ubtu18stig_ssh_required

      - name: "MEDIUM | UBTU-18-010038 | PATCH | The Ubuntu operating system must display the Standard Mandatory DoD Notice and Consent Banner before granting any publically accessible connection to the system. | Set banner message"
        copy:
            dest: "{{ item }}"
            content: "{{ ubtu18cis_warning_banner }}"
            owner: root
            group: root
            mode: '0644'
        notify: restart sshd
        with_items:
            - /etc/issue
            - /etc/issue.net
  when:
      - ubtu_18_010038
      - ubtu18stig_ssh_required
  tags:
      - UBTU-18-010038
      - CAT2
      - CCI-000048
      - CCI-001384
      - CCI-001385
      - CCI-001386
      - CCI-001387
      - CCI-001388
      - SRG-OS-000228-GPOS-00088
      - SV-219170r610963_rule
      - V-219170
      - banner

- name: "MEDIUM | UBTU-18-010104 | PATCH | The Ubuntu operating system must encrypt all stored passwords with a FIPS 140-2 approved cryptographic hashing algorithm."
  lineinfile:
      path: /etc/login.defs
      regexp: '^ENCRYPT_METHOD.*'
      line: "ENCRYPT_METHOD {{ ubtu18stig_login_defaults.encrypt_method | default('SHA512') }}"
  when:
      - ubtu_18_010104
  tags:
      - UBTU-18-010104
      - CAT2
      - CCI-000196
      - SRG-OS-000073-GPOS-00041
      - SV-219176r610963_rule
      - V-219176
      - fips
      - encryption

- name: "MEDIUM | UBTU-18-010109 | PATCH | The Ubuntu operating system must enforce a minimum 15-character password length."
  lineinfile:
      path: /etc/security/pwquality.conf
      regexp: '^#?\s*minlen'
      line: "minlen = {{ ubtu18stig_password_complexity.minlen | default('15') }}"
      create: true
      owner: root
      group: root
      mode: 0644
  when:
      - ubtu_18_010109
  tags:
      - UBTU-18-010109
      - CAT2
      - CCI-000205
      - SRG-OS-000078-GPOS-00046
      - SV-219181r610963_rule
      - V-219181
      - accounts

- name: "MEDIUM | UBTU-18-010110 | PATCH | The Ubuntu operating system must employ a FIPS 140-2 approved cryptographic hashing algorithms for all created and stored passwords."
  block:
      - name: "MEDIUM | UBTU-18-010110 | AUDIT | The Ubuntu operating system must employ a FIPS 140-2 approved cryptographic hashing algorithms for all created and stored passwords. | Get status of pam_unix.so"
        shell: grep 'password.*{{ ubtu18stig_pamd_encryption.new_control }}.*pam_unix.so' /etc/pam.d/common-password
        changed_when: false
        failed_when: false
        register: ubtu_18_010110_pam_unix_so

      - name: "MEDIUM | UBTU-18-010110 | PATCH | The Ubuntu operating system must employ a FIPS 140-2 approved cryptographic hashing algorithms for all created and stored passwords. | Add encryption if pam_unix exists"
        pamd:
            name: common-password
            type: password
            control: "{{ ubtu18stig_pamd_encryption.new_control }}"
            module_path: pam_unix.so
            module_arguments: "{{ ubtu18stig_pamd_encryption.encryption }}"
            state: args_present
        when: ubtu_18_010110_pam_unix_so.stdout | length > 0

      - name: "MEDIUM | UBTU-18-010110 | PATCH | The Ubuntu operating system must employ a FIPS 140-2 approved cryptographic hashing algorithms for all created and stored passwords. | Add encryption if pam_unix doesn't exists"
        pamd:
            name: common-password
            type: "{{ ubtu18stig_pamd_encryption.type }}"
            control: "{{ ubtu18stig_pamd_encryption.control }}"
            module_path: "{{ ubtu18stig_pamd_encryption.module_path }}"
            new_type: password
            new_control: "{{ ubtu18stig_pamd_encryption.new_control }}"
            new_module_path: pam_unix.so
            module_arguments: "{{ ubtu18stig_pamd_encryption.encryption }}"
            state: "{{ ubtu18stig_pamd_encryption.state }}"
        when: ubtu_18_010110_pam_unix_so.stdout | length == 0

      - name: "MEDIUM | UBTU-18-010110 | PATCH | The Ubuntu operating system must employ a FIPS 140-2 approved cryptographic hashing algorithms for all created and stored passwords. | Add ENCRYPT_METHOD"
        lineinfile:
            path: /etc/login.defs
            regexp: '^ENCRYPT_METHOD'
            line: "ENCRYPT_METHOD {{ ubtu18stig_login_defaults.encrypt_method }}"
  when:
      - ubtu_18_010110
  tags:
      - UBTU-18-010110
      - CAT2
      - CCI-000803
      - SRG-OS-000120-GPOS-00061
      - SV-219182r610963_rule
      - V-219182
      - pamd
      - encryption

- name: "MEDIUM | UBTU-18-010112 | AUDIT | The Ubuntu operating system must allow the use of a temporary password for system logons with an immediate change to a permanent password."
  debug:
      msg:
          - "Warning!! Please create a policy that ensures when a user is created, it is created using a method that forces a user to change their password upon their next login."
          - 'For example: "chage -d 0 [UserName]" or "passwd -e [UserName]"'
  when:
      - ubtu_18_010112
  tags:
      - UBTU-18-010112
      - CAT2
      - CCI-002041
      - SRG-OS-000380-GPOS-00165
      - SV-219183r610963_rule
      - V-219183
      - passwords
      - accounts

- name: "MEDIUM | UBTU-18-010113 | PATCH | The Ubuntu operating system must prevent the use of dictionary words for passwords."
  lineinfile:
      path: /etc/security/pwquality.conf
      regexp: '^dictcheck='
      line: 'dictcheck={{ ubtu18stig_password_complexity.dictcheck }}'
      create: true
      owner: root
      group: root
      mode: 0644
  when:
      - ubtu_18_010113
  tags:
      - UBTU-18-010113
      - CAT2
      - CCI-000366
      - SRG-OS-000480-GPOS-00225
      - SV-219184r610963_rule
      - V-219184
      - passwords

- name: "MEDIUM | UBTU-18-010114 | PATCH | The Ubuntu operating system must require users to re-authenticate for privilege escalation and changing roles."
  replace:
      path: /etc/sudoers
      regexp: "{{ item.regexp }}"
      replace: "{{ item.replace }}"
  with_items:
      - { regexp: '^([^#|{% if system_is_ec2 %}ec2-user{% endif %}].*)NOPASSWD(.*)', replace: '\1PASSWD\2' }
      - { regexp: '^([^#].*)!authenticate(.*)', replace: '\1authenticate\2' }
  loop_control:
      label: "{{ item.replace }}"
  when:
      - ubtu_18_010114
  tags:
      - UBTU-18-010114
      - CAT2
      - CCI-002038
      - SRG-OS-000373-GPOS-00156
      - SV-219185r610963_rule
      - V-219185
      - sudo

- name: "MEDIUM | UBTU-18-010116 | PATCH | The Ubuntu Operating system must be configured so that when passwords are changed or new passwords are established, pwquality must be used."
  block:
      - name: "MEDIUM | UBTU-18-010116 | AUDIT | The Ubuntu Operating system must be configured so that when passwords are changed or new passwords are established, pwquality must be used. | Find the pamd settings"
        shell: grep 'password.*requisite.*pam_pwquality.so' /etc/pam.d/common-password
        changed_when: false
        failed_when: false
        register: ubtu_18_010116_pam_pwquality_so

      - name: "MEDIUM | UBTU-18-010116 | PATCH | The Ubuntu Operating system must be configured so that when passwords are changed or new passwords are established, pwquality must be used. | Add retry setting if exists"
        pamd:
            name: common-password
            type: password
            control: requisite
            module_path: pam_pwquality.so
            module_arguments: "retry={{ ubtu18stig_pam_pwquality_retry }}"
            state: args_present
        when: ubtu_18_010116_pam_pwquality_so.stdout | length > 0

      - name: "MEDIUM | UBTU-18-010116 | PATCH | The Ubuntu Operating system must be configured so that when passwords are changed or new passwords are established, pwquality must be used. | Add retry setting if doesn't exists"
        pamd:
            name: common-password
            type: "{{ ubtu18stig_pamd_retry.type }}"
            control: "{{ ubtu18stig_pamd_retry.control }}"
            module_path: "{{ ubtu18stig_pamd_retry.module_path }}"
            new_type: password
            new_control: requisite
            new_module_path: pam_pwquality.so
            module_arguments: "retry={{ ubtu18stig_pam_pwquality_retry }}"
            state: "{{ ubtu18stig_pamd_retry.state }}"
        when: ubtu_18_010116_pam_pwquality_so.stdout | length == 0

      - name: "MEDIUM | UBTU-18-010116 | PATCH | The Ubuntu Operating system must be configured so that when passwords are changed or new passwords are established, pwquality must be used. | Install libpam-pwquality"
        package:
            name: libpam-pwquality
            state: present
        when: "'libpam-pwquality' not in ansible_facts.packages"

      - name: "MEDIUM | UBTU-18-010116 | PATCH | The Ubuntu Operating system must be configured so that when passwords are changed or new passwords are established, pwquality must be used. | Set the enforcing setting"
        lineinfile:
            path: /etc/security/pwquality.conf
            regexp: '^enforcing =|^#.*enforcing ='
            line: 'enforcing ='
  when:
      - ubtu_18_010116
  tags:
      - UBTU-18-010116
      - CAT2
      - CCI-000366
      - SRG-OS-000480-GPOS-00225
      - SV-219186r610963_rule
      - V-219186
      - pamd
      - pwquality
      - login

- name: "MEDIUM | UBTU-18-010120 | PATCH | The Ubuntu operating system must set a sticky bit on all public directories to prevent unauthorized and unintended information transferred via shared system resources."
  block:
      - name: "MEDIUM | UBTU-18-010120 | PATCH | The Ubuntu operating system must set a sticky bit on all public directories to prevent unauthorized and unintended information transferred via shared system resources. | Find world-writable directories"
        shell: "find / -type d \\( -perm -002 ! -perm -1000 \\) -print 2>/dev/null | sed 's/.* //'"
        changed_when: false
        failed_when: false
        register: ubtu_18_010120_world_writable_directories

      - name: "MEDIUM | UBTU-18-010120 | PATCH | The Ubuntu operating system must set a sticky bit on all public directories to prevent unauthorized and unintended information transferred via shared system resources. | Add sticky bit to world-writable directories"
        file:
            path: "{{ item }}"
            mode: '1777'
        with_items:
            - "{{ ubtu_18_010120_world_writable_directories.stdout_lines }}"
        when: ubtu_18_010120_world_writable_directories.stdout | length > 0
  when:
      - ubtu_18_010120
  tags:
      - UBTU-18-010120
      - CAT2
      - CCI-001090
      - SRG-OS-000138-GPOS-00069
      - SV-219187r610963_rule
      - V-219187
      - permissions

- name: "MEDIUM | UBTU-18-010121 | PATCH | The Ubuntu operating system must generate error messages that provide information necessary for corrective actions without revealing information that could be exploited by adversaries."
  block:
      - name: "MEDIUM | UBTU-18-010121 | AUDIT | The Ubuntu operating system must generate error messages that provide information necessary for corrective actions without revealing information that could be exploited by adversaries. | Find if files exist"
        shell: find /var/log -perm /137 -type f -exec stat -c "%n %a" {} \;
        changed_when: false
        failed_when: false
        register: ubtu_18_010121_var_log_permissions

      - name: "MEDIUM | UBTU-18-010121 | PATCH | The Ubuntu operating system must generate error messages that provide information necessary for corrective actions without revealing information that could be exploited by adversaries. | Fix files"
        shell: find /var/log -perm /137 -type f -exec chmod 640 '{}' \;
        changed_when: true
        when: ubtu_18_010121_var_log_permissions.stdout | length > 0
  when:
      - ubtu_18_010121
  tags:
      - UBTU-18-010121
      - CAT2
      - CCI-001312
      - SRG-OS-000205-GPOS-00083
      - SV-219188r610963_rule
      - V-219188
      - permissions

- name: |
    "MEDIUM | UBTU-18-010122 | PATCH | The Ubuntu operating system must configure the /var/log directory to be group-owned by syslog."
    "MEDIUM | UBTU-18-010123 | PATCH | The Ubuntu operating system must configure the /var/log directory to be owned by root."
    "MEDIUM | UBTU-18-010124 | PATCH | The Ubuntu operating system must configure the /var/log directory to have mode 0750 or less permissive."
  file:
      path: /var/log
      owner: "{{ ubtu_18_010123 | ternary('root',omit) }}"
      group: "{{ ubtu_18_010122 | ternary('syslog',omit) }}"
      mode: "{{ ubtu_18_010124 | ternary(ubtu18cis_var_log_perms,omit) }}"
      state: directory
  when:
      - ubtu_18_010122 or
        ubtu_18_010123 or
        ubtu_18_010124
  tags:
      - UBTU-18-010122
      - UBTU-18-010123
      - UBTU-18-010124
      - CAT2
      - CCI-001314
      - SRG-OS-000206-GPOS-00084
      - SV-219189r610963_rule
      - SV-219190r610963_rule
      - SV-219191r610963_rule
      - V-219189
      - V-219190
      - V-219191
      - permissions

- name: |
    "MEDIUM | UBTU-18-010125 | PATCH | The Ubuntu operating system must configure the /var/log/syslog file to be group-owned by adm."
    "MEDIUM | UBTU-18-010126 | PATCH | he Ubuntu operating system must configure /var/log/syslog file to be owned by syslog."
    "MEDIUM | UBTU-18-010127 | PATCH | The Ubuntu operating system must configure /var/log/syslog file with mode 0640 or less permissive."
  file:
      path: /var/log/syslog
      owner: "{{ ubtu_18_010126 | ternary('syslog',omit) }}"
      group: "{{ ubtu_18_010125 | ternary('adm',omit) }}"
      mode: "{{ ubtu_18_010127 | ternary(ubtu18cis_var_log_syslog_perms,omit) }}"
      state: directory
  when:
      - ubtu_18_010125 or
        ubtu_18_010126 or
        ubtu_18_010127
  tags:
      - UBTU-18-010125
      - UBTU-18-010126
      - UBTU-18-010127
      - CAT2
      - CCI-001314
      - SRG-OS-000206-GPOS-00084
      - SV-219192r610963_rule
      - SV-219193r610963_rule
      - SV-219194r610963_rule
      - V-219192
      - V-219193
      - V-219194
      - permissions

- name: |
    "MEDIUM | UBTU-18-010128 | PATCH | The Ubuntu operating system must configure audit tools with a mode of 0755 or less permissive."
    "MEDIUM | UBTU-18-010129 | PATCH | The Ubuntu operating system must configure audit tools to be owned by root."
    "MEDIUM | UBTU-18-010130 | PATCH | The Ubuntu operating system must configure the audit tools to be group-owned by root."
  block:
      - name: |
          "MEDIUM | UBTU-18-010128 | PATCH | The Ubuntu operating system must configure audit tools with a mode of 0755 or less permissive. | Find tools with less than 755 perms"
          "MEDIUM | UBTU-18-010129 | PATCH | The Ubuntu operating system must configure audit tools to be owned by root."
          "MEDIUM | UBTU-18-010130 | PATCH | The Ubuntu operating system must configure the audit tools to be group-owned by root."
        shell: stat -c "%a %n" /sbin/auditctl, /sbin/aureport, /sbin/ausearch, /sbin/autrace, /sbin/auditd, /sbin/audispd, /sbin/augenrules | cut -f2 -d" "
        changed_when: false
        failed_when: false
        register: ubtu_18_010129_tools

      - name: |
          "MEDIUM | UBTU-18-010128 | PATCH | The Ubuntu operating system must configure audit tools with a mode of 0755 or less permissive. | Set permissions to 755 on tools"
          "MEDIUM | UBTU-18-010129 | PATCH | The Ubuntu operating system must configure audit tools to be owned by root."
          "MEDIUM | UBTU-18-010130 | PATCH | The Ubuntu operating system must configure the audit tools to be group-owned by root."
        file:
            path: "{{ item }}"
            owner: "{{ ubtu_18_010129 | ternary('root',omit) }}"
            group: "{{ ubtu_18_010130 | ternary('root',omit) }}"
            mode: "{{ ubtu_18_010128 | ternary(ubtu18cis_tool_perms,omit) }}"
        with_items:
            - "{{ ubtu_18_010129_tools.stdout_lines }}"
        when: ubtu_18_010129_tools.stdout | length > 0
  when:
      - ubtu_18_010128 or
        ubtu_18_010129 or
        ubtu_18_010130
  tags:
      - UBTU-18-010128
      - UBTU-18-010129
      - CAT2
      - CCI-001493
      - CCI-001494
      - CCI-001495
      - SRG-OS-000256-GPOS-00097
      - SV-219195r610963_rule
      - SV-219196r610963_rule
      - SV-219197r610963_rule
      - V-219195
      - V-219196
      - V-219197
      - permissions

- name: |
    "MEDIUM | UBTU-18-010133 | PATCH | The Ubuntu operating system library files must have mode 0755 or less permissive."
    "MEDIUM | UBTU-18-010135 | PATCH | The Ubuntu operating system library files must be owned by root."
    "MEDIUM | UBTU-18-010137 | PATCH | The Ubuntu operating system library files must be group-owned by root."
  block:
      - name: |
          "MEDIUM | UBTU-18-010133 | AUDIT | The Ubuntu operating system library files must have mode 0755 or less permissive. | Get library files with mode 0755 or less"
          "MEDIUM | UBTU-18-010135 | AUDIT | The Ubuntu operating system library files must be owned by root. | Get library files not owned by root"
          "MEDIUM | UBTU-18-010137 | AUDIT | The Ubuntu operating system library files must be group-owned by root. | Get library files not group-owned by root"
        shell: find /lib /lib64 /usr/lib \( ! -group root -o ! -user root -o -perm /022 \) -type f -exec stat -c "%n" '{}' \;
        changed_when: false
        failed_when: false
        register: ubtu_18_010133_lib_files

      - name: |
          "MEDIUM | UBTU-18-010133 | PATCH | The Ubuntu operating system library files must have mode 0755 or less permissive. | Set library files with mode 0755 or more restrictive"
          "MEDIUM | UBTU-18-010135 | PATCH | The Ubuntu operating system library files must be owned by root. | Set library files to be owned by root"
          "MEDIUM | UBTU-18-010137 | PATCH | The Ubuntu operating system library files must be group-owned by root. | Set library files not group-owned by root"
        file:
            path: "{{ item }}"
            owner: "{{ ubtu_18_010135 | ternary('root',omit) }}"
            group: "{{ ubtu_18_010137 | ternary('root',omit) }}"
            mode: "{{ ubtu_18_010133 | ternary(ubtu18stig_lib_file_perms,omit) }}"
        with_items:
            "{{ ubtu_18_010133_lib_files.stdout_lines }}"
        when: ubtu_18_010133_lib_files.stdout | length > 0
  when:
      - ubtu_18_010133 or
        ubtu_18_010135 or
        ubtu_18_010137
  tags:
      - UBTU-18-010133
      - UBTU-18-010135
      - UBTU-18-010137
      - CAT2
      - CCI-001499
      - SRG-OS-000259-GPOS-00100
      - SV-219198r802358_rule
      - SV-219200r610963_rule
      - SV-219202r802361_rule
      - V-219198
      - V-219200
      - V-219202
      - permissions

# - name: "MEDIUM | UBTU-18-010133 | PATCH | The Ubuntu operating system library files must have mode 0755 or less permissive."
#   block:
#       - name: "MEDIUM | UBTU-18-010133 | AUDIT | The Ubuntu operating system library files must have mode 0755 or less permissive. | Get library files with mode 0755 or less"
#         shell: find /lib /lib64 /usr/lib -perm /022 -type f -exec stat -c "%n %a" '{}' \; | cut -d" " -f1
#         changed_when: false
#         failed_when: false
#         register: ubtu_18_010133_lib_files

#       - name: "MEDIUM | UBTU-18-010133 | PATCH | The Ubuntu operating system library files must have mode 0755 or less permissive. | Set library files with mode 0755 or more restrictive"
#         file:
#             path: "{{ item }}"
#             mode: "{{ ubtu18stig_lib_file_perms }}"
#         with_items:
#             "{{ ubtu_18_010133_lib_files.stdout_lines }}"
#         when: ubtu_18_010133_lib_files.stdout | length > 0
#   when:
#       - ubtu_18_010133
#   tags:
#       - UBTU-18-010133
#       - CAT2
#       - CCI-001499
#       - SRG-OS-000259-GPOS-00100
#       - SV-219198r802358_rule
#       - V-219198
#       - permissions
- name: |
    "MEDIUM | UBTU-18-010134 | PATCH | The Ubuntu operating system library directories must have mode 0755 or less permissive."
    "MEDIUM | UBTU-18-010136 | PATCH | The Ubuntu operating system library directories must be owned by root."
    "MEDIUM | UBTU-18-010138 | PATCH | The Ubuntu operating system library directories must be group-owned by root."
  block:
      - name: |
          "MEDIUM | UBTU-18-010134 | AUDIT | The Ubuntu operating system library directories must have mode 0755 or less permissive. | Get library directories with 750 or less"
          "MEDIUM | UBTU-18-010136 | AUDIT | The Ubuntu operating system library directories must be owned by root. | Get OS library directories not owned by root"
          "MEDIUM | UBTU-18-010138 | AUDIT | The Ubuntu operating system library directories must be group-owned by root. | Get OS library directories not group-owned by root"
        shell: find /lib /lib64 /usr/lib \( ! -group root -o ! -user root -o -perm /022 \) -type d -exec stat -c "%n" '{}' \;
        changed_when: false
        failed_when: false
        register: ubtu_18_010134_lib_dirs

      - name: |
          "MEDIUM | UBTU-18-010134 | PATCH | The Ubuntu operating system library directories must have mode 0755 or less permissive. | Set library directories with 755 or more restrictive"
          "MEDIUM | UBTU-18-010136 | PATCH | The Ubuntu operating system library directories must be owned by root. | Set OS library directories not owned by root"
          "MEDIUM | UBTU-18-010138 | PATCH | The Ubuntu operating system library directories must be group-owned by root. | Set OS library directories not group-owned by root"
        file:
            path: "{{ item }}"
            owner: "{{ ubtu_18_010136 | ternary('root',omit) }}"
            group: "{{ ubtu_18_010138 | ternary('root',omit) }}"
            mode: "{{ ubtu_18_010134 | ternary(ubtu18stig_lib_dir_perms,omit) }}"
            state: directory
        with_items:
            - "{{ ubtu_18_010134_lib_dirs.stdout_lines }}"
        when: ubtu_18_010134_lib_dirs.stdout | length > 0
  when:
      - ubtu_18_010134 or
        ubtu_18_010136 or
        ubtu_18_010138
  tags:
      - UBTU-18-010134
      - UBTU-18-010136
      - UBTU-18-010138
      - CAT2
      - CCI-001499
      - SRG-OS-000259-GPOS-00100
      - SV-219199r610963_rule
      - SV-219201r610963_rule
      - SV-219203r610963_rule
      - V-219199
      - V-219201
      - V-219203
      - permissions

# - name: "MEDIUM | UBTU-18-010134 | PATCH | The Ubuntu operating system library directories must have mode 0755 or less permissive."
#   block:
#       - name: "MEDIUM | UBTU-18-010134 | AUDIT | The Ubuntu operating system library directories must have mode 0755 or less permissive. | Get library directories with 750 or less"
#         shell: find /lib /lib64 /usr/lib -perm /022 -type d -exec stat -c "%n %a" '{}' \; | cut -d" " -f1
#         changed_when: false
#         failed_when: false
#         register: ubtu_18_010134_lib_dirs

#       - debug: var=ubtu_18_010134_lib_dirs

#       - name: "MEDIUM | UBTU-18-010134 | PATCH | The Ubuntu operating system library directories must have mode 0755 or less permissive. | Set library directories with 755 or more restrictive"
#         file:
#             path: "{{ item }}"
#             mode: "{{ ubtu18stig_lib_dir_perms }}"
#             state: directory
#         loop:
#             - "{{ ubtu_18_010134_lib_dirs.stdout_lines }}"
#         when: ubtu_18_010134_lib_dirs.stdout | length > 0
#   when:
#       - ubtu_18_010134
#   tags:
#       - UBTU-18-010134
#       - CAT2
#       - CCI-001499
#       - SRG-OS-000259-GPOS-00100
#       - SV-219199r610963_rule
#       - V-219199
#       - permissions

# - name: "MEDIUM | UBTU-18-010135 | PATCH | The Ubuntu operating system library files must be owned by root."
#   block:
#       - name: "MEDIUM | UBTU-18-010135 | AUDIT | The Ubuntu operating system library files must be owned by root. | Get OS files not owned by root"
#         shell: find /lib /usr/lib /lib64 ! -user root -type f -exec stat -c "%n %U" '{}' \; | cut -d" " -f1
#         changed_when: false
#         failed_when: false
#         register: ubtu_18_010135_lib_files_owner

#       - name: "MEDIUM | UBTU-18-010135 | PATCH | The Ubuntu operating system library files must be owned by root. | Set OS files to be owned by root"
#         file:
#             path: "{{ item }}"
#             owner: root
#         with_items:
#             - "{{ ubtu_18_010135_lib_files_owner.stdout_lines }}"
#         when: ubtu_18_010135_lib_files_owner.stdout | length > 0
#   when:
#       - ubtu_18_010135
#   tags:
#       - UBTU-18-010135
#       - CAT2
#       - CCI-001499
#       - SRG-OS-000259-GPOS-00100
#       - SV-219200r610963_rule
#       - V-219200
#       - permissions

# - name: "MEDIUM | UBTU-18-010136 | PATCH | The Ubuntu operating system library directories must be owned by root."
#   block:
#       - name: "MEDIUM | UBTU-18-010136 | AUDIT | The Ubuntu operating system library directories must be owned by root. | Get OS library directories not owned by root"
#         shell: find /lib /usr/lib /lib64 ! -user root -type d -exec stat -c "%n %U" '{}' \; | cut -d" " -f1
#         changed_when: false
#         failed_when: false
#         register: ubtu_18_010136_lib_files_owner

#       - name: "MEDIUM | UBTU-18-010136 | PATCH | The Ubuntu operating system library directories must be owned by root. | Set OS library directories not owned by root"
#         file:
#             path: "{{ item }}"
#             owner: root
#             state: directory
#         with_items:
#             - "{{ ubtu_18_010136_lib_files_owner.stdout_lines }}"
#         when: ubtu_18_010136_lib_files_owner.stdout | length > 0
#   when:
#       - ubtu_18_010136
#   tags:
#       - UBTU-18-010136
#       - CAT2
#       - CCI-001499
#       - SRG-OS-000259-GPOS-00100
#       - SV-219201r610963_rule
#       - V-219201
#       - permissions

# - name: "MEDIUM | UBTU-18-010137 | PATCH | The Ubuntu operating system library files must be group-owned by root."
#   block:
#       - name: "MEDIUM | UBTU-18-010137 | AUDIT | The Ubuntu operating system library files must be group-owned by root. | Get OS library files not group-owned by root"
#         shell: find /lib /usr/lib /lib64 ! -group root -type f -exec stat -c "%n %G" '{}' \; | cut -d" " -f1
#         changed_when: false
#         failed_when: false
#         register: ubtu_18_010137_lib_files_group

#       - name: "MEDIUM | UBTU-18-010137 | PATCH | The Ubuntu operating system library files must be group-owned by root. | Set OS library files not group-owned by root"
#         file:
#             path: "{{ item }}"
#             group: root
#         with_items:
#             - "{{ ubtu_18_010137_lib_files_group.stdout_lines }}"
#         when: ubtu_18_010137_lib_files_group.stdout | length > 0
#   when:
#       - ubtu_18_010137
#   tags:
#       - UBTU-18-010137
#       - CAT2
#       - CCI-001499
#       - SRG-OS-000259-GPOS-00100
#       - SV-219202r802361_rule
#       - V-219202
#       - permissions

# - name: "MEDIUM | UBTU-18-010138 | PATCH | The Ubuntu operating system library directories must be group-owned by root."
#   block:
#       - name: "MEDIUM | UBTU-18-010138 | AUDIT | The Ubuntu operating system library directories must be group-owned by root. | Get OS library directories not group-owned by root"
#         shell: find /lib /usr/lib /lib64 ! -group root -type d -exec stat -c "%n %G" '{}' \; | cut -d" " -f1
#         changed_when: false
#         failed_when: false
#         register: ubtu_18_010138_lib_dirs_group
#       - debug: var=ubtu_18_010138_lib_dirs_group
#       - name: "MEDIUM | UBTU-18-010138 | PATCH | The Ubuntu operating system library directories must be group-owned by root. | Set OS library directories not group-owned by root"
#         file:
#             name: "{{ item }}"
#             group: root
#             state: directory
#         with_items:
#             - "{{ ubtu_18_010138_lib_dirs_group.stdout_lines }}"
#         when: ubtu_18_010138_lib_dirs_group.stdout | length > 0
#   when:
#       - ubtu_18_010138
#   tags:
#       - UBTU-18-010138
#       - CAT2
#       - CCI-001499
#       - SRG-OS-000259-GPOS-00100
#       - SV-219203r610963_rule
#       - V-219203
#       - permissions

- name: |
    "MEDIUM | UBTU-18-010139 | PATCH | The Ubuntu operating system must have system commands set to a mode of 0755 or less permissive."
    "MEDIUM | UBTU-18-010141 | PATCH | The Ubuntu operating system must have system commands owned by root."
    "MEDIUM | UBTU-18-010143 | PATCH | The Ubuntu operating system must have system commands group-owned by root or a system account."
  block:
      - name: |
          "MEDIUM | UBTU-18-010139 | AUDIT | The Ubuntu operating system must have system commands set to a mode of 0755 or less permissive. | Get OS commands with mode less than 755"
          "MEDIUM | UBTU-18-010141 | AUDIT | The Ubuntu operating system must have system commands owned by root. | Get OS commands not owned by root"
          "MEDIUM | UBTU-18-010143 | PATCH | The Ubuntu operating system must have system commands group-owned by root or a system account. | Get OS commands not group-owned by root"
        shell: find -L /bin /sbin /usr/bin /usr/sbin /usr/local/bin /usr/local/sbin \( ! -group root -o ! -user root -o -perm /022 \) -type f -exec stat -c "%n" '{}' \;
        changed_when: false
        failed_when: false
        register: ubtu_18_010139_commands_perms

      - name: |
          "MEDIUM | UBTU-18-010139 | PATCH | The Ubuntu operating system must have system commands set to a mode of 0755 or less permissive. | Set OS commands with mode 755 or more restricive"
          "MEDIUM | UBTU-18-010141 | PATCH | The Ubuntu operating system must have system commands owned by root. | Set OS commands not owned by root to owned by root"
          "MEDIUM | UBTU-18-010143 | PATCH | The Ubuntu operating system must have system commands group-owned by root or a system account. | Set OS commands not group-owned by root to root"
        file:
            path: "{{ item }}"
            owner: "{{ ubtu_18_010141 | ternary('root',omit) }}"
            group: "{{ ubtu_18_010143 | ternary('root',omit) }}"
            mode: "{{ ubtu_18_010139 | ternary(ubtu18stig_sys_commands_perms,omit) }}"
        with_items:
            - "{{ ubtu_18_010139_commands_perms.stdout_lines }}"
        when:  ubtu_18_010139_commands_perms.stdout | length > 0
  when:
      - ubtu_18_010139 or
        ubtu_18_010141 or
        ubtu_18_010143
  tags:
      - UBTU-18-010139
      - UBTU-18-010141
      - UBTU-18-010143
      - CAT2
      - CCI-001499
      - SRG-OS-000259-GPOS-00100
      - SV-219204r610963_rule
      - SV-219206r610963_rule
      - SV-219208r832925_rule
      - V-219204
      - V-219206
      - V-219208
      - permissions

# - name: "MEDIUM | UBTU-18-010139 | PATCH | The Ubuntu operating system must have system commands set to a mode of 0755 or less permissive."
#   block:
#       - name: "MEDIUM | UBTU-18-010139 | AUDIT | The Ubuntu operating system must have system commands set to a mode of 0755 or less permissive. | Get OS commands with mode less than 755"
#         shell: find -L /bin /sbin /usr/bin /usr/sbin /usr/local/bin /usr/local/sbin -perm /022 -type f -exec stat -c "%n %a" '{}' \; | cut -d" " -f1
#         changed_when: false
#         failed_when: false
#         register: ubtu_18_010139_commands_perms

#       - name: "MEDIUM | UBTU-18-010139 | PATCH | The Ubuntu operating system must have system commands set to a mode of 0755 or less permissive. | Set OS commands with mode 755 or more restricive"
#         file:
#             path: "{{ item }}"
#             mode: "{{ ubtu18stig_sys_commands_perms }}"
#         with_items:
#             - "{{ ubtu_18_010139_commands_perms.stdout_lines }}"
#         when:  ubtu_18_010139_commands_perms.stdout | length > 0
#   when:
#       - ubtu_18_010139
#   tags:
#       - UBTU-18-010139
#       - CAT2
#       - CCI-001499
#       - SRG-OS-000259-GPOS-00100
#       - SV-219204r610963_rule
#       - V-219204
#       - permissions

- name: |
    "MEDIUM | UBTU-18-010140 | PATCH | The Ubuntu operating system must have directories that contain system commands set to a mode of 0755 or less permissive."
    "MEDIUM | UBTU-18-010142 | PATCH | The Ubuntu operating system must have directories that contain system commands owned by root."
    "MEDIUM | UBTU-18-010144 | PATCH | The Ubuntu operating system must have directories that contain system commands group-owned by root."
  block:
      - name: |
          "MEDIUM | UBTU-18-010140 | AUDIT | The Ubuntu operating system must have directories that contain system commands set to a mode of 0755 or less permissive. | Get OS command directories with mode less than 755"
          "MEDIUM | UBTU-18-010142 | AUDIT | The Ubuntu operating system must have directories that contain system commands owned by root. | Get OS command dirs not owned by root"
          "MEDIUM | UBTU-18-010144 | PATCH | The Ubuntu operating system must have directories that contain system commands group-owned by root. | Get OS command dirs not group-owned by root"
        shell: find -L /bin /sbin /usr/bin /usr/sbin /usr/local/bin /usr/local/sbin \( ! -group root -o ! -user root -o -perm /022 \) -type d -exec stat -c "%n" '{}' \;
        changed_when: false
        failed_when: false
        register: ubtu_18_010140_command_dir_perms

      - name: |
          "MEDIUM | UBTU-18-010140 | PATCH | The Ubuntu operating system must have directories that contain system commands set to a mode of 0755 or less permissive. | Set OS command directories with mode 755 or more restricive"
          "MEDIUM | UBTU-18-010142 | PATCH | The Ubuntu operating system must have directories that contain system commands owned by root. | Set OS command dirs not owned by root to root"
          "MEDIUM | UBTU-18-010144 | PATCH | The Ubuntu operating system must have directories that contain system commands group-owned by root. | Set OS command dirs not group-owned by root to root"
        file:
            path: "{{ item }}"
            owner: "{{ ubtu_18_010142 | ternary('root',omit) }}"
            group: "{{ ubtu_18_010144 | ternary('root',omit) }}"
            mode: "{{ ubtu_18_010140 | ternary(ubtu18stig_sys_comm_dir_perms,omit) }}"
            state: directory
        with_items:
            - "{{ ubtu_18_010140_command_dir_perms.stdout_lines }}"
        when: ubtu_18_010140_command_dir_perms.stdout | length > 0
  when:
      - ubtu_18_010140 or
        ubtu_18_010142 or
        ubtu_18_010144
  tags:
      - UBTU-18-010140
      - UBTU-18-010142
      - UBTU-18-010144
      - CAT2
      - CCI-001499
      - SRG-OS-000259-GPOS-00100
      - SV-219205r610963_rule
      - SV-219207r610963_rule
      - SV-219209r610963_rule
      - V-219205
      - V-219207
      - V-219209
      - permissions


# - name: "MEDIUM | UBTU-18-010140 | PATCH | The Ubuntu operating system must have directories that contain system commands set to a mode of 0755 or less permissive."
#   block:
#       - name: "MEDIUM | UBTU-18-010140 | AUDIT | The Ubuntu operating system must have directories that contain system commands set to a mode of 0755 or less permissive. | Get OS command directories with mode less than 755"
#         shell: find -L /bin /sbin /usr/bin /usr/sbin /usr/local/bin /usr/local/sbin -perm /022 -type d -exec stat -c "%n %a" '{}' \; | cut -d" " -f1
#         changed_when: false
#         failed_when: false
#         register: ubtu_18_010140_command_dir_perms

#       - name: "MEDIUM | UBTU-18-010140 | PATCH | The Ubuntu operating system must have directories that contain system commands set to a mode of 0755 or less permissive. | Set OS command directories with mode 755 or more restricive"
#         file:
#             path: "{{ item }}"
#             mode: "{{ ubtu18stig_sys_comm_dir_perms }}"
#             state: directory
#         with_items:
#             - "{{ ubtu_18_010140_command_dir_perms.stdout_lines }}"
#         when: ubtu_18_010140_command_dir_perms.stdout | length > 0
#   when:
#       - ubtu_18_010140
#   tags:
#       - UBTU-18-010140
#       - CAT2
#       - CCI-001499
#       - SRG-OS-000259-GPOS-00100
#       - SV-219205r610963_rule
#       - V-219205
#       - permissions

# - name: "MEDIUM | UBTU-18-010141 | PATCH | The Ubuntu operating system must have system commands owned by root."
#   block:
#         - name: "MEDIUM | UBTU-18-010141 | AUDIT | The Ubuntu operating system must have system commands owned by root. | Get OS commands not owned by root"
#           shell: find -L /bin /sbin /usr/bin /usr/sbin /usr/local/bin /usr/local/sbin ! -user root -type f -exec stat -c "%n %U" '{}' \; | cut -d" " -f1
#           changed_when: false
#           failed_when: false
#           register: ubtu_18_010141_sys_comm_files_owner

#         - name: "MEDIUM | UBTU-18-010141 | PATCH | The Ubuntu operating system must have system commands owned by root. | Set OS commands not owned by root to owned by root"
#           file:
#               path: "{{ item }}"
#               owner: root
#           with_items:
#               - "{{ ubtu_18_010141_sys_comm_files_owner.stdout_lines }}"
#           when: ubtu_18_010141_sys_comm_files_owner.stdout | length > 0
#   when:
#       - ubtu_18_010141
#   tags:
#       - UBTU-18-010141
#       - CAT2
#       - CCI-001499
#       - SRG-OS-000259-GPOS-00100
#       - SV-219206r610963_rule
#       - V-219206
#       - permissions

# - name: "MEDIUM | UBTU-18-010142 | PATCH | The Ubuntu operating system must have directories that contain system commands owned by root."
#   block:
#       - name: "MEDIUM | UBTU-18-010142 | AUDIT | The Ubuntu operating system must have directories that contain system commands owned by root. | Get OS command dirs not owned by root"
#         shell: find -L /bin /sbin /usr/bin /usr/sbin /usr/local/bin /usr/local/sbin ! -user root -type d -exec stat -c "%n %U" '{}' \; | cut -d" " -f1
#         changed_when: false
#         failed_when: false
#         register: ubtu_18_010142_sys_comm_dir_owner

#       - debug: var=ubtu_18_010142_sys_comm_dir_owner
#       - name: "MEDIUM | UBTU-18-010142 | PATCH | The Ubuntu operating system must have directories that contain system commands owned by root. | Set OS command dirs not owned by root to root"
#         file:
#             path: "{{ item }}"
#             owner: root
#             state: directory
#         with_items:
#             - "{{ ubtu_18_010142_sys_comm_dir_owner.stdout_lines }}"
#         when: ubtu_18_010142_sys_comm_dir_owner.stdout | length > 0
#   when:
#       - ubtu_18_010142
#   tags:
#       - UBTU-18-010142
#       - CAT2
#       - CCI-001499
#       - SRG-OS-000259-GPOS-00100
#       - SV-219207r610963_rule
#       - V-219207
#       - permissions

# - name: "MEDIUM | UBTU-18-010143 | PATCH | The Ubuntu operating system must have system commands group-owned by root or a system account."
#   block:
#       - name: "MEDIUM | UBTU-18-010143 | PATCH | The Ubuntu operating system must have system commands group-owned by root or a system account. | Get OS commands not group-owned by root"
#         shell: find -L /bin /sbin /usr/bin /usr/sbin /usr/local/bin /usr/local/sbin ! -group root -type f -exec stat -c "%n" '{}' \;
#         changed_when: false
#         failed_when: false
#         register: ubtu_18_010143_sys_comm_files_group

#       - debug: var=ubtu_18_010143_sys_comm_files_group

#       - name: "MEDIUM | UBTU-18-010143 | PATCH | The Ubuntu operating system must have system commands group-owned by root or a system account. | Set OS commands not group-owned by root to root"
#         file:
#             path: "{{ item }}"
#             group: root
#         with_items:
#             - "{{ ubtu_18_010143_sys_comm_files_group.stdout_lines }}"
#         when: ubtu_18_010143_sys_comm_files_group.stdout | length > 0
#   when:
#       - ubtu_18_010143
#   tags:
#       - UBTU-18-010143
#       - CAT2
#       - CCI-001499
#       - SRG-OS-000259-GPOS-00100
#       - SV-219208r832925_rule
#       - V-219208
#       - permessions

# - name: "MEDIUM | UBTU-18-010144 | PATCH | The Ubuntu operating system must have directories that contain system commands group-owned by root."
#   block:
#       - name: "MEDIUM | UBTU-18-010144 | PATCH | The Ubuntu operating system must have directories that contain system commands group-owned by root. | Get OS command dirs not group-owned by root"
#         shell: find -L /bin /sbin /usr/bin /usr/sbin /usr/local/bin /usr/local/sbin ! -group root -type d -exec stat -c "%n" '{}' \;
#         changed_when: false
#         failed_when: false
#         register: ubtu_18_010144_sys_comm_dirs_group

#       - name: "MEDIUM | UBTU-18-010144 | PATCH | The Ubuntu operating system must have directories that contain system commands group-owned by root."
#         file:
#             path: "{{ item }}"
#             group: root
#             state: directory
#         with_items:
#             - "{{ ubtu_18_010144_sys_comm_dirs_group.stdout_lines }}"
#         when: ubtu_18_010144_sys_comm_dirs_group.stdout | length > 0
#   when:
#       - ubtu_18_010144
#   tags:
#       - UBTU-18-010144
#       - CAT2
#       - CCI-001499
#       - SRG-OS-000259-GPOS-00100
#       - SV-219209r610963_rule
#       - V-219209
#       - permissions

- name: "MEDIUM | UBTU-18-010201 | PATCH | The Ubuntu operating system must generate audit records for the use and modification of the tallylog file."
  debug:
      msg: "Control being set via Handler 'update auditd' which writes to /etc/audit.d/99_stig_auditd.rules"
  changed_when: true
  notify: update auditd
  # lineinfile:
  #     path: /etc/audit/rules.d/99_stig_auditd.rules
  #     regexp: '^-w /var/log/tallylog'
  #     line: "-w /var/log/tallylog -p wa -k logins"
  #     create: true
  #     owner: root
  #     group: root
  #     mode: 0600
  # notify: reload auditd
  when:
      - ubtu_18_010201
  tags:
      - UBTU-18-010201
      - CAT2
      - CCI-000172
      - SRG-OS-000064-GPOS-00033
      - SV-219213r610963_rule
      - V-219213
      - auditd

- name: "MEDIUM | UBTU-18-010202 | PATCH | The Ubuntu operating system must generate audit records for the use and modification of faillog file."
  debug:
      msg: "Control being set via Handler 'update auditd' which writes to /etc/audit.d/99_stig_auditd.rules"
  changed_when: true
  notify: update auditd
  # lineinfile:
  #     path: /etc/audit/rules.d/99_stig_auditd.rules
  #     regexp: '^-w /var/log/faillog'
  #     line: "-w /var/log/faillog -p wa -k logins"
  #     create: true
  #     owner: root
  #     group: root
  #     mode: 0600
  # notify: reload auditd
  when:
      - ubtu_18_010202
  tags:
      - UBTU-18-010202
      - CAT2
      - CCI-000172
      - SRG-OS-000064-GPOS-00033
      - SV-219214r610963_rule
      - V-219214
      - auditd

- name: "MEDIUM | UBTU-18-010203 | PATCH | The Ubuntu operating system must generate audit records for the use and modification of the lastlog file."
  debug:
      msg: "Control being set via Handler 'update auditd' which writes to /etc/audit.d/99_stig_auditd.rules"
  changed_when: true
  notify: update auditd
  # lineinfile:
  #     path: /etc/audit/rules.d/99_stig_auditd.rules
  #     regexp: '^-w /var/log/lastlog'
  #     line: "-w /var/log/lastlog -p wa -k logins"
  #     create: true
  #     owner: root
  #     group: root
  #     mode: 0600
  # notify: reload auditd
  when:
      - ubtu_18_010203
  tags:
      - UBTU-18-010203
      - CAT2
      - CCI-000172
      - SRG-OS-000064-GPOS-00033
      - SV-219215r610963_rule
      - V-219215
      - auditd

- name: "MEDIUM | UBTU-18-010237 | PATCH | The Ubuntu operating system must generate audit records for privileged activities or other system-level access."
  debug:
      msg: "Control being set via Handler 'update auditd' which writes to /etc/audit.d/99_stig_auditd.rules"
  changed_when: true
  notify: update auditd
  # lineinfile:
  #     path: /etc/audit/rules.d/99_stig_auditd.rules
  #     regexp: '^-w /var/log/sudo.log'
  #     line: "-w /var/log/sudo.log -p wa -k actions"
  #     create: true
  #     owner: root
  #     group: root
  #     mode: 0600
  # notify: reload auditd
  when:
      - ubtu_18_010237
  tags:
      - UBTU-18-010237
      - CAT2
      - CCI-000172
      - SRG-OS-000471-GPOS-00215
      - SV-219216r610963_rule
      - V-219216
      - auditd

- name: "MEDIUM | UBTU-18-010238 | PATCH | The Ubuntu operating system must generate audit records for the /var/log/wtmp file."
  debug:
      msg: "Control being set via Handler 'update auditd' which writes to /etc/audit.d/99_stig_auditd.rules"
  changed_when: true
  notify: update auditd
  # lineinfile:
  #     path: /etc/audit/rules.d/99_stig_auditd.rules
  #     regexp: '^-w /var/log/wtmp'
  #     line: "-w /var/log/wtmp -p wa -k logins"
  #     create: true
  #     owner: root
  #     group: root
  #     mode: 0600
  # notify: reload auditd
  when:
      - ubtu_18_010238
  tags:
      - UBTU-18-010238
      - CAT2
      - CCI-000172
      - SRG-OS-000472-GPOS-00217
      - SV-219217r610963_rule
      - V-219217
      - auditd

- name: "MEDIUM | UBTU-18-010239 | PATCH | The Ubuntu operating system must generate audit records for the /var/run/utmp file."
  debug:
      msg: "Control being set via Handler 'update auditd' which writes to /etc/audit.d/99_stig_auditd.rules"
  changed_when: true
  notify: update auditd
  # lineinfile:
  #     path: /etc/audit/rules.d/99_stig_auditd.rules
  #     regexp: '^-w /var/run/utmp'
  #     line: "-w /var/run/utmp -p wa -k logins"
  #     create: true
  #     owner: root
  #     group: root
  #     mode: 0600
  # notify: reload auditd
  when:
      - ubtu_18_010239
  tags:
      - UBTU-18-010239
      - CAT2
      - CCI-000172
      - SRG-OS-000472-GPOS-00217
      - SV-219218r802364_rule
      - V-219218
      - auditd

- name: "MEDIUM | UBTU-18-010240 | PATCH | The Ubuntu operating system must generate audit records for the /var/log/btmp file."
  debug:
      msg: "Control being set via Handler 'update auditd' which writes to /etc/audit.d/99_stig_auditd.rules"
  changed_when: true
  notify: update auditd
  # lineinfile:
  #     path: /etc/audit/rules.d/99_stig_auditd.rules
  #     regexp: '^-w /var/log/btmp'
  #     line: "-w /var/log/btmp -p wa -k logins"
  #     create: true
  #     owner: root
  #     group: root
  #     mode: 0600
  # notify: reload auditd
  when:
      - ubtu_18_010240
  tags:
      - UBTU-18-010240
      - CAT2
      - CCI-000172
      - SRG-OS-000472-GPOS-00217
      - SV-219219r610963_rule
      - V-219219
      - auditd

- name: "MEDIUM | UBTU-18-010244 | PATCH | The Ubuntu operating system must generate audit records for all account creations, modifications, disabling, and termination events that affect /etc/passwd."
  debug:
      msg: "Control being set via Handler 'update auditd' which writes to /etc/audit.d/99_stig_auditd.rules"
  changed_when: true
  notify: update auditd
  # lineinfile:
  #     path: /etc/audit/rules.d/99_stig_auditd.rules
  #     regexp: '^-w /etc/passwd'
  #     line: "-w /etc/passwd -p wa -k usergroup_modification"
  #     create: true
  #     owner: root
  #     group: root
  #     mode: 0600
  # notify: reload auditd
  when:
      - ubtu_18_010244
  tags:
      - UBTU-18-010244
      - CAT2
      - CCI-000018
      - CCI-000172
      - CCI-001403
      - CCI-001404
      - CCI-001405
      - CCI-002130
      - SRG-OS-000476-GPOS-00221
      - SV-219220r610963_rule
      - V-219220
      - auditd

- name: "MEDIUM | UBTU-18-010245 | PATCH | The Ubuntu operating system must generate audit records for all account creations, modifications, disabling, and termination events that affect /etc/group."
  debug:
      msg: "Control being set via Handler 'update auditd' which writes to /etc/audit.d/99_stig_auditd.rules"
  changed_when: true
  notify: update auditd
  # lineinfile:
  #     path: /etc/audit/rules.d/99_stig_auditd.rules
  #     regexp: '^-w /etc/group -p wa -k'
  #     line: "-w /etc/group -p wa -k usergroup_modification"
  #     create: true
  #     owner: root
  #     group: root
  #     mode: 0600
  # notify: reload auditd
  when:
      - ubtu_18_010245
  tags:
      - UBTU-18-010245
      - CAT2
      - CCI-000172
      - CCI-001403
      - CCI-001404
      - CCI-001405
      - CCI-002130
      - SRG-OS-000476-GPOS-00221
      - SV-219221r610963_rule
      - V-219221
      - auditd

- name: "MEDIUM | UBTU-18-010246 | PATCH | The Ubuntu operating system must generate audit records for all account creations, modifications, disabling, and termination events that affect /etc/gshadow."
  debug:
      msg: "Control being set via Handler 'update auditd' which writes to /etc/audit.d/99_stig_auditd.rules"
  changed_when: true
  notify: update auditd
  # lineinfile:
  #     path: /etc/audit/rules.d/99_stig_auditd.rules
  #     regexp: '^-w /etc/gshadow -p wa -k'
  #     line: "-w /etc/gshadow -p wa -k usergroup_modification"
  #     create: true
  #     owner: root
  #     group: root
  #     mode: 0600
  # notify: reload auditd
  when:
      - ubtu_18_010246
  tags:
      - UBTU-18-010246
      - CAT2
      - CCI-000172
      - CCI-001403
      - CCI-001404
      - CCI-001405
      - CCI-002130
      - SRG-OS-000476-GPOS-00221
      - SV-219222r610963_rule
      - V-219222
      - auditd

- name: "MEDIUM | UBTU-18-010247 | PATCH | The Ubuntu operating system must generate audit records for all account creations, modifications, disabling, and termination events that affect /etc/shadow."
  debug:
      msg: "Control being set via Handler 'update auditd' which writes to /etc/audit.d/99_stig_auditd.rules"
  changed_when: true
  notify: update auditd
  # lineinfile:
  #     path: /etc/audit/rules.d/99_stig_auditd.rules
  #     regexp: '^-w /etc/shadow'
  #     line: "-w /etc/shadow -p wa -k usergroup_modification"
  #     create: true
  #     owner: root
  #     group: root
  #     mode: 0600
  # notify: reload auditd
  when:
      - ubtu_18_010247
  tags:
      - UBTU-18-010247
      - CAT2
      - CCI-000172
      - CCI-001403
      - CCI-001404
      - CCI-001405
      - CCI-002130
      - SRG-OS-000476-GPOS-00221
      - SV-219223r610963_rule
      - V-219223
      - auditd

- name: "MEDIUM | UBTU-18-010248 | PATCH | The Ubuntu operating system must generate audit records for all account creations, modifications, disabling, and termination events that affect /etc/security/opasswd."
  debug:
      msg: "Control being set via Handler 'update auditd' which writes to /etc/audit.d/99_stig_auditd.rules"
  changed_when: true
  notify: update auditd
  # lineinfile:
  #     path: /etc/audit/rules.d/99_stig_auditd.rules
  #     regexp: '^-w /etc/security/opasswd'
  #     line: "-w /etc/security/opasswd -p wa -k usergroup_modification"
  #     create: true
  #     owner: root
  #     group: root
  #     mode: 0600
  # notify: reload auditd
  when:
      - ubtu_18_010248
  tags:
      - UBTU-18-010248
      - CAT2
      - CCI-000172
      - CCI-001403
      - CCI-001404
      - CCI-001405
      - CCI-002130
      - SRG-OS-000476-GPOS-00221
      - SV-219224r610963_rule
      - V-219224
      - auditd

- name: "MEDIUM | UBTU-18-010250 | PATCH | The Ubuntu operating system must produce audit records and reports containing information to establish when, where, what type, the source, and the outcome for all DoD-defined auditable events and actions in near real time."
  systemd:
      name: auditd
      state: started
      enabled: true
  when:
      - ubtu_18_010250
  tags:
      - UBTU-18-010250
      - CAT2
      - CCI-000131
      - CCI-000132
      - CCI-000133
      - CCI-000134
      - CCI-000135
      - CCI-000154
      - CCI-000158
      - CCI-000169
      - CCI-000172
      - CCI-001814
      - CCI-001875
      - CCI-001876
      - CCI-001877
      - CCI-001878
      - CCI-001879
      - CCI-001880
      - CCI-001914
      - CCI-002884
      - SRG-OS-000038-GPOS-00016
      - SV-219225r610963_rule
      - V-219225
      - auditd
      - services

- name: "MEDIUM | UBTU-18-010300 | PATCH | The Ubuntu operating system must alert the ISSO and SA (at a minimum) in the event of an audit processing failure."
  lineinfile:
      path: /etc/audit/auditd.conf
      regexp: '^action_mail_acct ='
      line: "action_mail_acct = {{ ubtu18stig_auditd_mail_acct }}"
  register: ubtu_18_010300_action_mail_acct_result
  failed_when:
      - ubtu_18_010300_action_mail_acct_result is failed
      - ubtu_18_010300_action_mail_acct_result.rc != 257
  when:
      - ubtu_18_010300
  tags:
      - UBTU-18-010300
      - CAT2
      - CCI-000139
      - SRG-OS-000046-GPOS-00022
      - SV-219226r610963_rule
      - V-219226
      - auditd

- name: "MEDIUM | UBTU-18-010301 | PATCH | The Ubuntu operating system must shut down by default upon audit failure (unless availability is an overriding concern)."
  lineinfile:
      path: /etc/audit/auditd.conf
      regexp: '^disk_full_action ='
      line: "disk_full_action = {{ ubtu18stig_auditd_disk_full_action }}"
  when:
      - ubtu_18_010301
  tags:
      - UBTU-18-010301
      - CAT2
      - CCI-000140
      - SRG-OS-000047-GPOS-00023
      - SV-219227r610963_rule
      - V-219227
      - auditd

- name: |
    "MEDIUM | UBTU-18-010305 | PATCH | The Ubuntu operating system must be configured so that audit log files cannot be read or write-accessible by unauthorized users."
    "MEDIUM | UBTU-18-010306 | PATCH | The Ubuntu operating system must permit only authorized accounts ownership of the audit log files."
    "MEDIUM | UBTU-18-010307 | PATCH | The Ubuntu operating system must permit only authorized groups to own the audit log files."
  file:
      path: "{{ ubtu_18_audit_log_path.stdout }}"
      owner: "{{ ubtu_18_010306 | ternary('root',omit) }}"
      group: "{{ ubtu_18_010307 | ternary('root',omit) }}"
      mode: "{{ ubtu_18_010305 | ternary(ubtu18stig_audit_log_files,omit) }}"
      recurse: true
  when:
      - ubtu_18_010305 or
        ubtu_18_010306 or
        ubtu_18_010307
  tags:
      - UBTU-18-010305
      - UBTU-18-010306
      - CAT2
      - CCI-000162
      - CCI-000163
      - SRG-OS-000058-GPOS-00028
      - SV-219228r610963_rule
      - SV-219229r610963_rule
      - V-219228
      - V-219229
      - auditd

- name: |
    "MEDIUM | UBTU-18-010308 | PATCH | The Ubuntu operating system must be configured so that the audit log directory is not write-accessible by unauthorized users."
    "MEDIUM | UBTU-18-010309 | PATCH | The Ubuntu operating system must allow only authorized accounts to own the audit log directory."
    "MEDIUM | UBTU-18-010310 | PATCH | The Ubuntu operating system must ensure only authorized groups can own the audit log directory and its underlying files."
  file:
      path: "{{ ubtu_18_audit_log_path.stdout }}"
      owner: "{{ ubtu_18_010309 | ternary('root',omit) }}"
      group: "{{ ubtu_18_010310 | ternary('root',omit) }}"
      mode: "{{ ubtu_18_010308 | ternary(ubtu18stig_audit_log_dirs,omit) }}"
      state: directory
  when:
      - ubtu_18_010308 or
        ubtu_18_010309 or
        ubtu_18_010310
  tags:
      - UBTU-18-010308
      - UBTU-18-010309
      - UBTU-18-010310
      - CAT2
      - CCI-000164
      - SRG-OS-000059-GPOS-00029
      - SV-219231r610963_rule
      - SV-219232r610963_rule
      - SV-219233r610963_rul
      - V-219231
      - V-219232
      - V-219233
      - auditd

- name: |
    "MEDIUM | UBTU-18-010311 | PATCH | The Ubuntu operating system must be configured so that audit configuration files are not write-accessible by unauthorized users."
    "MEDIUM | UBTU-18-010312 | PATCH | The Ubuntu operating system must permit only authorized accounts to own the audit configuration files."
    "MEDIUM | UBTU-18-010313 | PATCH | The Ubuntu operating system must permit only authorized groups to own the audit configuration files."
  block:
      - name: |
          "MEDIUM | UBTU-18-010311 | PATCH | The Ubuntu operating system must be configured so that audit configuration files are not write-accessible by unauthorized users. | Set permissions for audit.rule and auditd.conf"
          "MEDIUM | UBTU-18-010312 | PATCH | The Ubuntu operating system must permit only authorized accounts to own the audit configuration files. | Set owner for audit.rule and auditd.conf"
          "MEDIUM | UBTU-18-010313 | PATCH | The Ubuntu operating system must permit only authorized groups to own the audit configuration files. | Set group for audit.rule and auditd.conf"
        file:
            path: "{{ item }}"
            mode: "{{ ubtu_18_010311 | ternary(ubtu18stig_audit_rules_conf_perms,omit) }}"
        with_items:
            - /etc/audit/audit.rule
            - /etc/audit/auditd.conf

      - name: |
          "MEDIUM | UBTU-18-010311 | PATCH | The Ubuntu operating system must be configured so that audit configuration files are not write-accessible by unauthorized users. | Set permissions for audit/rules.d files"
          "MEDIUM | UBTU-18-010312 | PATCH | The Ubuntu operating system must permit only authorized accounts to own the audit configuration files. | Set owner for audit/rules.d files"
          "MEDIUM | UBTU-18-010313 | PATCH | The Ubuntu operating system must permit only authorized groups to own the audit configuration files. | Set group for audit/rules.d files"
        file:
            path: /etc/audit/rules.d
            owner: "{{ ubtu_18_010312 | ternary('root',omit) }}"
            group: "{{ ubtu_18_010313 | ternary('root',omit) }}"
            mode: "{{ ubtu_18_010311 | ternary(ubtu18stig_audit_rules_conf_perms,omit) }}"
            recurse: true
  when:
      - ubtu_18_010311 or
        ubtu_18_010312 or
        ubtu_18_010313
  tags:
      - UBTU-18-010311
      - UBTU-18-010312
      - UBTU-18-010313
      - CAT2
      - CCI-000171
      - SRG-OS-000063-GPOS-00032
      - SV-219234r610963_rule
      - SV-219235r610963_rule
      - SV-219236r610963_rule
      - V-219234
      - V-219235
      - V-219236
      - auditd

- name: "MEDIUM | UBTU-18-010315 | PATCH | The Ubuntu operating system must generate audit records for successful/unsuccessful uses of the su command."
  debug:
      msg: "Control being set via Handler 'update auditd' which writes to /etc/audit.d/99_stig_auditd.rules"
  changed_when: true
  notify: update auditd
  # lineinfile:
  #     path: /etc/audit/rules.d/99_stig_auditd.rules
  #     regexp: '^-a always,exit -F path=/bin/su'
  #     line: "-a always,exit -F path=/bin/su -F perm=x -F auid>={{ ubtu18stig_int_gid }} -F auid!=4294967295 -k privileged-priv_change"
  # notify: reload auditd
  when:
      - ubtu_18_010315
  tags:
      - UBTU-18-010315
      - CAT2
      - CCI-000172
      - SRG-OS-000064-GPOS-00033
      - SV-219238r610963_rule
      - V-219238
      - auditd

- name: "MEDIUM | UBTU-18-010316 | PATCH | The Ubuntu operating system must generate audit records for successful/unsuccessful uses of the chfn command."
  debug:
      msg: "Control being set via Handler 'update auditd' which writes to /etc/audit.d/99_stig_auditd.rules"
  changed_when: true
  notify: update auditd
  # lineinfile:
  #     path: /etc/audit/rules.d/99_stig_auditd.rules
  #     regexp: '^-a always,exit -F path=/usr/bin/chfn'
  #     line: "-a always,exit -F path=/usr/bin/chfn -F perm=x -F auid>={{ ubtu18stig_int_gid }} -F auid!=4294967295 -k privileged-chfn"
  # notify: reload auditd
  when:
      - ubtu_18_010316
  tags:
      - UBTU-18-010316
      - CAT2
      - CCI-000172
      - SRG-OS-000064-GPOS-00033
      - SV-219239r610963_rule
      - V-219239
      - auditd

- name: "MEDIUM | UBTU-18-010317 | PATCH | The Ubuntu operating system must generate audit records for successful/unsuccessful uses of the mount command."
  debug:
      msg: "Control being set via Handler 'update auditd' which writes to /etc/audit.d/99_stig_auditd.rules"
  changed_when: true
  notify: update auditd
  # lineinfile:
  #     path: /etc/audit/rules.d/99_stig_auditd.rules
  #     regexp: '^-a always,exit -F path=/bin/mount'
  #     line: "-a always,exit -F path=/bin/mount -F perm=x -F auid>={{ ubtu18stig_int_gid }} -F auid!=4294967295 -k privileged-mount"
  # notify: reload auditd
  when:
      - ubtu_18_010317
  tags:
      - UBTU-18-010317
      - CAT2
      - CCI-000172
      - SRG-OS-000064-GPOS-00033
      - SV-219240r610963_rule
      - V-219240
      - auditd

- name: "MEDIUM | UBTU-18-010318 | PATCH | The Ubuntu operating system must generate audit records for successful/unsuccessful uses of the umount command."
  debug:
      msg: "Control being set via Handler 'update auditd' which writes to /etc/audit.d/99_stig_auditd.rules"
  changed_when: true
  notify: update auditd
  # lineinfile:
  #     path: /etc/audit/rules.d/99_stig_auditd.rules
  #     regexp: '^-a always,exit -F path=/bin/umount'
  #     line: "-a always,exit -F path=/bin/umount -F perm=x -F auid>={{ ubtu18stig_int_gid }} -F auid!=4294967295 -k privileged-umount"
  # notify: reload auditd
  when:
      - ubtu_18_010318
  tags:
      - UBTU-18-010318
      - CAT2
      - CCI-000172
      - SRG-OS-000064-GPOS-00033
      - SV-219241r610963_rule
      - V-219241
      - auditd

- name: "MEDIUM | UBTU-18-010319 | PATCH | The Ubuntu operating system must generate audit records for successful/unsuccessful uses of the ssh-agent command."
  debug:
      msg: "Control being set via Handler 'update auditd' which writes to /etc/audit.d/99_stig_auditd.rules"
  changed_when: true
  notify: update auditd
  # lineinfile:
  #     path: /etc/audit/rules.d/99_stig_auditd.rules
  #     regexp: '^-a always,exit -F path=/usr/bin/ssh-agent'
  #     line: "-a always,exit -F path=/usr/bin/ssh-agent -F perm=x -F auid>={{ ubtu18stig_int_gid }} -F auid!=4294967295 -k privileged-ssh"
  # notify: reload auditd
  when:
      - ubtu_18_010319
  tags:
      - UBTU-18-010319
      - CAT2
      - CCI-000172
      - SRG-OS-000064-GPOS-00033
      - SV-219242r610963_rule
      - V-219242
      - auditd

- name: "MEDIUM | UBTU-18-010320 | PATCH | The Ubuntu operating system must generate audit records for successful/unsuccessful uses of the ssh-keysign command."
  debug:
      msg: "Control being set via Handler 'update auditd' which writes to /etc/audit.d/99_stig_auditd.rules"
  changed_when: true
  notify: update auditd
  # lineinfile:
  #     path: /etc/audit/rules.d/99_stig_auditd.rules
  #     regexp: '^-a always,exit -F path=/usr/lib/openssh/ssh-keysign'
  #     line: "-a always,exit -F path=/usr/lib/openssh/ssh-keysign -F perm=x -F auid>={{ ubtu18stig_int_gid }} -F auid!=4294967295 -k privileged-ssh"
  # notify: reload auditd
  when:
      - ubtu_18_010320
  tags:
      - UBTU-18-010320
      - CAT2
      - CCI-000172
      - SRG-OS-000064-GPOS-00033
      - SV-219243r610963_rule
      - V-219243
      - aduitd

- name: "MEDIUM | UBTU-18-010321 | PATCH | The Ubuntu operating system must generate audit records for any usage of the setxattr, fsetxattr, lsetxattr, removexattr, fremovexattr, and lremovexattr system calls."
  debug:
      msg: "Control being set via Handler 'update auditd' which writes to /etc/audit.d/99_stig_auditd.rules"
  changed_when: true
  notify: update auditd
  # block:
  #     - name: "MEDIUM | UBTU-18-010321 | PATCH | The Ubuntu operating system must generate audit records for any usage of the setxattr, fsetxattr, lsetxattr, removexattr, fremovexattr, and lremovexattr system calls."
  #       lineinfile:
  #           path: /etc/audit/rules.d/99_stig_auditd.rules
  #           regexp: "{{ item.regexp }}"
  #           line: "{{ item.line }}"
  #       notify: reload auditd
  #       with_items:
  #           - { regexp: '^-a always,exit -F arch=b64 -S setxattr,fsetxattr,lsetxattr,removexattr,fremovexattr,lremovexattr -F auid>={{ ubtu18stig_int_gid }}', line: "-a always,exit -F arch=b64 -S setxattr,fsetxattr,lsetxattr,removexattr,fremovexattr,lremovexattr -F auid>={{ ubtu18stig_int_gid }} -F auid!=4294967295 -k perm_mod" }
  #           - { regexp: '^-a always,exit -F arch=b64 -S setxattr,fsetxattr,lsetxattr,removexattr,fremovexattr,lremovexattr -F auid=0 ', line: "-a always,exit -F arch=b64 -S setxattr,fsetxattr,lsetxattr,removexattr,fremovexattr,lremovexattr -F auid=0 -k perm_mod" }
  #           - { regexp: '^-a always,exit -F arch=b32 -S setxattr,fsetxattr,lsetxattr,removexattr,fremovexattr,lremovexattr -F auid>={{ ubtu18stig_int_gid }}', line: "-a always,exit -F arch=b32 -S setxattr,fsetxattr,lsetxattr,removexattr,fremovexattr,lremovexattr -F auid>={{ ubtu18stig_int_gid }} -F auid!=4294967295 -k perm_mod" }
  #           - { regexp: '^-a always,exit -F arch=b32 -S setxattr,fsetxattr,lsetxattr,removexattr,fremovexattr,lremovexattr -F auid=0', line: "-a always,exit -F arch=b32 -S setxattr,fsetxattr,lsetxattr,removexattr,fremovexattr,lremovexattr -F auid=0 -k perm_mod" }
  #       when: "'x86_64' in ansible_facts.userspace_architecture"

  #     - name: "MEDIUM | UBTU-18-010321 | PATCH | The Ubuntu operating system must generate audit records for any usage of the setxattr, fsetxattr, lsetxattr, removexattr, fremovexattr, and lremovexattr system calls."
  #       lineinfile:
  #           path: /etc/audit/rules.d/99_stig_auditd.rules
  #           regexp: "{{ item.regexp }}"
  #           line: "{{ item.line }}"
  #       notify: reload auditd
  #       with_items:
  #           - { regexp: '^-a always,exit -F arch=b32 -S setxattr,fsetxattr,lsetxattr,removexattr,fremovexattr,lremovexattr -F auid>={{ ubtu18stig_int_gid }}', line: "-a always,exit -F arch=b32 -S setxattr,fsetxattr,lsetxattr,removexattr,fremovexattr,lremovexattr -F auid>={{ ubtu18stig_int_gid }} -F auid!=4294967295 -k perm_mod" }
  #           - { regexp: '^-a always,exit -F arch=b32 -S setxattr,fsetxattr,lsetxattr,removexattr,fremovexattr,lremovexattr -F auid=0', line: "-a always,exit -F arch=b32 -S setxattr,fsetxattr,lsetxattr,removexattr,fremovexattr,lremovexattr -F auid=0 -k perm_mod " }
  #       when: "'x86_64' not in ansible_facts.userspace_architecture"
  when:
      - ubtu_18_010321
  tags:
      - UBTU-18-010321
      - CAT2
      - CCI-000172
      - SRG-OS-000064-GPOS-00033
      - SV-219244r809514_rule
      - V-219244
      - auditd

- name: "MEDIUM | UBTU-18-010327 | PATCH | The Ubuntu operating system must generate audit records for successful/unsuccessful uses of the chown, fchown, fchownat, and lchown system calls."
  debug:
      msg: "Control being set via Handler 'update auditd' which writes to /etc/audit.d/99_stig_auditd.rules"
  changed_when: true
  notify: update auditd
  # block:
  #     - name: "MEDIUM | UBTU-18-010327 | PATCH | The Ubuntu operating system must generate audit records for successful/unsuccessful uses of the chown, fchown, fchownat, and lchown system calls."
  #       lineinfile:
  #           path: /etc/audit/rules.d/99_stig_auditd.rules
  #           regexp: "{{ item.regexp }}"
  #           line: "{{ item.line }}"
  #       notify: reload auditd
  #       with_items:
  #           - { regexp: '^-a always,exit -F arch=b64 -S chown,fchown,fchownat,lchown -F auid>={{ ubtu18stig_int_gid }}', line: "-a always,exit -F arch=b64 -S chown,fchown,fchownat,lchown -F auid>={{ ubtu18stig_int_gid }} -F auid!=4294967295 -k perm_chng" }
  #           - { regexp: '^-a always,exit -F arch=b32 -S chown,fchown,fchownat,lchown -F auid>={{ ubtu18stig_int_gid }}', line: "-a always,exit -F arch=b32 -S chown,fchown,fchownat,lchown -F auid>={{ ubtu18stig_int_gid }} -F auid!=4294967295 -k perm_chng"}
  #       when: "'x86_64' in ansible_facts.userspace_architecture"

  #     - name: "MEDIUM | UBTU-18-010327 | PATCH | The Ubuntu operating system must generate audit records for successful/unsuccessful uses of the chown, fchown, fchownat, and lchown system calls."
  #       lineinfile:
  #           path: /etc/audit/rules.d/99_stig_auditd.rules
  #           regexp: '^-a always,exit -F arch=b32 -S chown,fchown,fchownat,lchown -F auid>={{ ubtu18stig_int_gid }}'
  #           line: "-a always,exit -F arch=b32 -S chown,fchown,fchownat,lchown -F auid>={{ ubtu18stig_int_gid }} -F auid!=4294967295 -k perm_chng"
  #       notify: reload auditd
  #       when: "'x86_64' not in ansible_facts.userspace_architecture"
  when:
      - ubtu_18_010327
  tags:
      - UBTU-18-010327
      - CAT2
      - CCI-000172
      - SRG-OS-000064-GPOS-00033
      - SV-219250r809517_rule
      - V-219250
      - auditd

- name: "MEDIUM | UBTU-18-010331 | PATCH | The Ubuntu operating system must generate audit records for successful/unsuccessful uses of the chmod, fchmod, and fchmodat system calls."
  debug:
      msg: "Control being set via Handler 'update auditd' which writes to /etc/audit.d/99_stig_auditd.rules"
  changed_when: true
  notify: update auditd
  # block:
  #     - name: "MEDIUM | UBTU-18-010331 | PATCH | The Ubuntu operating system must generate audit records for successful/unsuccessful uses of the chmod, fchmod, and fchmodat system calls."
  #       lineinfile:
  #           path: /etc/audit/rules.d/99_stig_auditd.rules
  #           regexp: '^-a always,exit -F arch=b64 -S chmod,fchmod,fchmodat -F auid>={{ ubtu18stig_int_gid }}'
  #           line: "-a always,exit -F arch=b64 -S chmod,fchmod,fchmodat -F auid>={{ ubtu18stig_int_gid }} -F auid!=4294967295 -k perm_chng"
  #       notify: reload auditd
  #       when: "'x86_64' in ansible_facts.userspace_architecture"
  #       with_items:
  #           - { regexp: '^-a always,exit -F arch=b32 -S chmod,fchmod,fchmodat -F auid>={{ ubtu18stig_int_gid }}', line: "-a always,exit -F arch=b32 -S chmod,fchmod,fchmodat -F auid>={{ ubtu18stig_int_gid }} -F auid!=4294967295 -k perm_chng" }
  #           - { regexp: '^-a always,exit -F arch=b64 -S chmod,fchmod,fchmodat -F auid>={{ ubtu18stig_int_gid }}', line: "-a always,exit -F arch=b64 -S chmod,fchmod,fchmodat -F auid>={{ ubtu18stig_int_gid }} -F auid!=4294967295 -k perm_chng" }

  #     - name: "MEDIUM | UBTU-18-010331 | PATCH | The Ubuntu operating system must generate audit records for successful/unsuccessful uses of the chmod, fchmod, and fchmodat system calls."
  #       lineinfile:
  #           path: /etc/audit/rules.d/99_stig_auditd.rules
  #           regexp: '^-a always,exit -F arch=b32 -S chmod,fchmod,fchmodat -F auid>={{ ubtu18stig_int_gid }}'
  #           line: "-a always,exit -F arch=b32 -S chmod,fchmod,fchmodat -F auid>={{ ubtu18stig_int_gid }} -F auid!=4294967295 -k perm_chng"
  #       notify: reload auditd
  #       when: "'x86_64' in ansible_facts.userspace_architecture"
  when:
      - ubtu_18_010331
  tags:
      - UBTU-18-010331
      - CAT2
      - CCI-000172
      - SRG-OS-000064-GPOS-00033
      - SV-219254r809520_rule
      - V-219254
      - auditd

- name: "MEDIUM | UBTU-18-010334 | PATCH | The Ubuntu operating system must generate audit records for successful/unsuccessful uses of the creat, open, openat, open_by_handle_at, truncate, and ftruncate system calls."
  debug:
      msg: "Control being set via Handler 'update auditd' which writes to /etc/audit.d/99_stig_auditd.rules"
  changed_when: true
  notify: update auditd
  # block:
  #     - name: "MEDIUM | UBTU-18-010334 | PATCH | The Ubuntu operating system must generate audit records for successful/unsuccessful uses of the creat, open, openat, open_by_handle_at, truncate, and ftruncate system calls."
  #       lineinfile:
  #           path: /etc/audit/rules.d/99_stig_auditd.rules
  #           regexp: "{{ item.regexp }}"
  #           line: "{{ item.line }}"
  #       notify: reload auditd
  #       with_items:
  #           - { regexp: '^-a always,exit -F arch=b32 -S creat,open,openat,open_by_handle_at,truncate,ftruncate -F exit=-EPERM -F auid>={{ ubtu18stig_int_gid }}', line: "-a always,exit -F arch=b32 -S creat,open,openat,open_by_handle_at,truncate,ftruncate -F exit=-EPERM -F auid>={{ ubtu18stig_int_gid }} -F auid!=4294967295 -k perm_access" }
  #           - { regexp: '^-a always,exit -F arch=b32 -S creat,open,openat,open_by_handle_at,truncate,ftruncate -F exit=-EACCES -F auid>={{ ubtu18stig_int_gid }}', line: "-a always,exit -F arch=b32 -S creat,open,openat,open_by_handle_at,truncate,ftruncate -F exit=-EACCES -F auid>={{ ubtu18stig_int_gid }} -F auid!=4294967295 -k perm_access" }
  #           - { regexp: '^-a always,exit -F arch=b64 -S creat,open,openat,open_by_handle_at,truncate,ftruncate -F exit=-EPERM -F auid>={{ ubtu18stig_int_gid }}', line: "-a always,exit -F arch=b64 -S creat,open,openat,open_by_handle_at,truncate,ftruncate -F exit=-EPERM -F auid>={{ ubtu18stig_int_gid }} -F auid!=4294967295 -k perm_access" }
  #           - { regexp: '^-a always,exit -F arch=b64 -S creat,open,openat,open_by_handle_at,truncate,ftruncate -F exit=-EACCES -F auid>={{ ubtu18stig_int_gid }}', line: "-a always,exit -F arch=b64 -S creat,open,openat,open_by_handle_at,truncate,ftruncate -F exit=-EACCES -F auid>={{ ubtu18stig_int_gid }} -F auid!=4294967295 -k perm_access"}
  #       when: "'x86_64' in ansible_facts.userspace_architecture"

  #     - name: "MEDIUM | UBTU-18-010334 | PATCH | The Ubuntu operating system must generate audit records for successful/unsuccessful uses of the creat, open, openat, open_by_handle_at, truncate, and ftruncate system calls."
  #       lineinfile:
  #           path: /etc/audit/rules.d/99_stig_auditd.rules
  #           regexp: "{{ item.regexp }}"
  #           line: "{{ item.line }}"
  #       notify: reload auditd
  #       with_items:
  #           - { regexp: '^-a always,exit -F arch=b32 -S creat,open,openat,open_by_handle_at,truncate,ftruncate -F exit=-EPERM -F auid>={{ ubtu18stig_int_gid }}', line: "-a always,exit -F arch=b32 -S creat,open,openat,open_by_handle_at,truncate,ftruncate -F exit=-EPERM -F auid>={{ ubtu18stig_int_gid }} -F auid!=4294967295 -k perm_access" }
  #           - { regexp: '^-a always,exit -F arch=b32 -S creat,open,openat,open_by_handle_at,truncate,ftruncate -F exit=-EACCES -F auid>={{ ubtu18stig_int_gid }}', line: "-a always,exit -F arch=b32 -S creat,open,openat,open_by_handle_at,truncate,ftruncate -F exit=-EACCES -F auid>={{ ubtu18stig_int_gid }} -F auid!=4294967295 -k perm_access" }
  #       when: "'x86_64' not in ansible_facts.userspace_architecture"
  when:
      - ubtu_18_010334
  tags:
      - UBTU-18-010334
      - CAT2
      - CCI-000172
      - SRG-OS-000064-GPOS-00033
      - SV-219257r809523_rule
      - V-219257
      - auditd

- name: "MEDIUM | UBTU-18-010340 | PATCH | The Ubuntu operating system must generate audit records for successful/unsuccessful uses of the sudo command."
  debug:
      msg: "Control being set via Handler 'update auditd' which writes to /etc/audit.d/99_stig_auditd.rules"
  changed_when: true
  notify: update auditd
  # lineinfile:
  #     path: /etc/audit/rules.d/99_stig_auditd.rules
  #     regex: '^-a always,exit -F path=/usr/bin/sudo -F perm=x -F auid>={{ ubtu18stig_int_gid }}'
  #     line: "-a always,exit -F path=/usr/bin/sudo -F perm=x -F auid>={{ ubtu18stig_int_gid }} -F auid!=4294967295 -k priv_cmd"
  # notify: reload auditd
  when:
      - ubtu_18_010340
  tags:
      - UBTU-18-010340
      - CAT2
      - CCI-000172
      - SRG-OS-000064-GPOS-00033
      - SV-219263r610963_rule
      - V-219263
      - auditd

- name: "MEDIUM | UBTU-18-010341 | PATCH | The Ubuntu operating system must generate audit records for successful/unsuccessful uses of the sudoedit command."
  debug:
      msg: "Control being set via Handler 'update auditd' which writes to /etc/audit.d/99_stig_auditd.rules"
  changed_when: true
  notify: update auditd
  # lineinfile:
  #     path: /etc/audit/rules.d/99_stig_auditd.rules
  #     regexp: '^-a always,exit -F path=/usr/bin/sudoedit -F perm=x -F auid>={{ ubtu18stig_int_gid }}'
  #     line: "-a always,exit -F path=/usr/bin/sudoedit -F perm=x -F auid>={{ ubtu18stig_int_gid }} -F auid!=4294967295 -k priv_cmd"
  # notify: reload auditd
  when:
      - ubtu_18_010341
  tags:
      - UBTU-18-010341
      - CAT2
      - CCI-000172
      - SRG-OS-000064-GPOS-00033
      - SV-219264r610963_rule
      - V-219264
      - auditd

- name: "MEDIUM | UBTU-18-010342 | PATCH | The Ubuntu operating system must generate audit records for successful/unsuccessful uses of the chsh command."
  debug:
      msg: "Control being set via Handler 'update auditd' which writes to /etc/audit.d/99_stig_auditd.rules"
  changed_when: true
  notify: update auditd
  # lineinfile:
  #     path: /etc/audit/rules.d/99_stig_auditd.rules
  #     regexp: '^-a always,exit -F path=/usr/bin/chsh -F perm=x -F auid>={{ ubtu18stig_int_gid }}'
  #     line: "-a always,exit -F path=/usr/bin/chsh -F perm=x -F auid>={{ ubtu18stig_int_gid }} -F auid!=4294967295 -k priv_cmd"
  # notify: reload auditd
  when:
      - ubtu_18_010342
  tags:
      - UBTU-18-010342
      - CAT2
      - CCI-000172
      - SRG-OS-000064-GPOS-00033
      - SV-219265r610963_rule
      - V-219265
      - auditd

- name: "MEDIUM | UBTU-18-010343 | PATCH | The Ubuntu operating system must generate audit records for successful/unsuccessful uses of the newgrp command."
  debug:
      msg: "Control being set via Handler 'update auditd' which writes to /etc/audit.d/99_stig_auditd.rules"
  changed_when: true
  notify: update auditd
  when:
      - ubtu_18_010343
  tags:
      - UBTU-18-010343
      - CAT2
      - CCI-000172
      - SRG-OS-000064-GPOS-00033
      - SV-219266r610963_rule
      - V-219266
      - auditd

- name: "MEDIUM | UBTU-18-010344 | PATCH | The Ubuntu operating system must generate audit records for successful/unsuccessful uses of the chcon command."
  debug:
      msg: "Control being set via Handler 'update auditd' which writes to /etc/audit.d/99_stig_auditd.rules"
  changed_when: true
  notify: update auditd
  when:
      - ubtu_18_010344
  tags:
      - UBTU-18-010344
      - CAT2
      - CCI-000172
      - SRG-OS-000064-GPOS-00033
      - SV-219267r610963_rule
      - V-219267
      - auditd

- name: "MEDIUM | UBTU-18-010345 | PATCH | The Ubuntu operating system must generate audit records for successful/unsuccessful uses of the apparmor_parser command."
  debug:
      msg: "Control being set via Handler 'update auditd' which writes to /etc/audit.d/99_stig_auditd.rules"
  changed_when: true
  notify: update auditd
  when:
      - ubtu_18_010345
  tags:
      - UBTU-18-010345
      - CAT2
      - CCI-000172
      - SRG-OS-000064-GPOS-00033
      - SV-219268r610963_rule
      - V-219268
      - auditd

- name: "MEDIUM | UBTU-18-010346 | PATCH | The Ubuntu operating system must generate audit records for successful/unsuccessful uses of the setfacl command."
  debug:
      msg: "Control being set via Handler 'update auditd' which writes to /etc/audit.d/99_stig_auditd.rules"
  changed_when: true
  notify: update auditd
  when:
      - ubtu_18_010346
  tags:
      - UBTU-18-010346
      - CAT2
      - CCI-000172
      - SRG-OS-000064-GPOS-00033
      - SV-219269r610963_rule
      - V-219269
      - auditd

- name: "MEDIUM | UBTU-18-010347 | PATCH | The Ubuntu operating system must generate audit records for successful/unsuccessful uses of the chacl command."
  debug:
      msg: "Control being set via Handler 'update auditd' which writes to /etc/audit.d/99_stig_auditd.rules"
  changed_when: true
  notify: update auditd
  when:
      - ubtu_18_010347
  tags:
      - UBTU-18-010347
      - CAT2
      - CCI-000172
      - SRG-OS-000064-GPOS-00033
      - SV-219270r610963_rule
      - V-219270
      - auditd

- name: "MEDIUM | UBTU-18-010348 | PATCH | The Ubuntu operating system must generate audit records for successful/unsuccessful uses of the passwd command."
  debug:
      msg: "Control being set via Handler 'update auditd' which writes to /etc/audit.d/99_stig_auditd.rules"
  changed_when: true
  notify: update auditd
  when:
      - ubtu_18_010348
  tags:
      - UBTU-18-010348
      - CAT2
      - CCI-000172
      - SRG-OS-000064-GPOS-00033
      - SV-219271r755156_rule
      - V-219271
      - auditd

- name: "MEDIUM | UBTU-18-010349 | PATCH | The Ubuntu operating system must generate audit records for successful/unsuccessful uses of the unix_update command."
  debug:
      msg: "Control being set via Handler 'update auditd' which writes to /etc/audit.d/99_stig_auditd.rules"
  changed_when: true
  notify: update auditd
  when:
      - ubtu_18_010349
  tags:
      - UBTU-18-010349
      - CAT2
      - CCI-000172
      - SRG-OS-000064-GPOS-00033
      - SV-219272r610963_rule
      - V-219272
      - auditd

- name: "MEDIUM | UBTU-18-010350 | PATCH | The Ubuntu operating system must generate audit records for successful/unsuccessful uses of the gpasswd command."
  debug:
      msg: "Control being set via Handler 'update auditd' which writes to /etc/audit.d/99_stig_auditd.rules"
  changed_when: true
  notify: update auditd
  when:
      - ubtu_18_010350
  tags:
      - UBTU-18-010350
      - CAT2
      - CCI-000172
      - SRG-OS-000064-GPOS-00033
      - SV-219273r610963_rule
      - V-219273
      - auditd

- name: "MEDIUM | UBTU-18-010351 | PATCH | The Ubuntu operating system must generate audit records for successful/unsuccessful uses of the chage command."
  debug:
      msg: "Control being set via Handler 'update auditd' which writes to /etc/audit.d/99_stig_auditd.rules"
  changed_when: true
  notify: update auditd
  when:
      - ubtu_18_010351
  tags:
      - UBTU-18-010351
      - CAT2
      - CCI-000172
      - SRG-OS-000064-GPOS-00033
      - SV-219274r610963_rule
      - V-219274
      - auditd

- name: "MEDIUM | UBTU-18-010352 | PATCH | The Ubuntu operating system must generate audit records for successful/unsuccessful uses of the usermod command."
  debug:
      msg: "Control being set via Handler 'update auditd' which writes to /etc/audit.d/99_stig_auditd.rules"
  changed_when: true
  notify: update auditd
  when:
      - ubtu_18_010352
  tags:
      - UBTU-18-010352
      - CAT2
      - CCI-000172
      - SRG-OS-000064-GPOS-00033
      - SV-219275r610963_rule
      - V-219275
      - auditd

- name: "MEDIUM | UBTU-18-010353 | PATCH | The Ubuntu operating system must generate audit records for successful/unsuccessful uses of the crontab command."
  debug:
      msg: "Control being set via Handler 'update auditd' which writes to /etc/audit.d/99_stig_auditd.rules"
  changed_when: true
  notify: update auditd
  when:
      - ubtu_18_010353
  tags:
      - UBTU-18-010353
      - CAT2
      - CCI-000172
      - SRG-OS-000064-GPOS-00033
      - SV-219276r610963_rule
      - V-219276
      - auditd

- name: "MEDIUM | UBTU-18-010354 | PATCH | The Ubuntu operating system must generate audit records for successful/unsuccessful uses of the pam_timestamp_check command."
  debug:
      msg: "Control being set via Handler 'update auditd' which writes to /etc/audit.d/99_stig_auditd.rules"
  changed_when: true
  notify: update auditd
  when:
      - ubtu_18_010354
  tags:
      - UBTU-18-010354
      - CAT2
      - CCI-000172
      - SRG-OS-000064-GPOS-00033
      - SV-219277r610963_rule
      - V-219277
      - auditd

- name: "MEDIUM | UBTU-18-010356 | PATCH | The Ubuntu operating system must generate audit records for successful/unsuccessful uses of the finit_module syscall."
  debug:
      msg: "Control being set via Handler 'update auditd' which writes to /etc/audit.d/99_stig_auditd.rules"
  changed_when: true
  notify: update auditd
  when:
      - ubtu_18_010356
  tags:
      - UBTU-18-010356
      - CAT2
      - CCI-000172
      - SRG-OS-000064-GPOS-00033
      - SV-219279r610963_rule
      - V-219279
      - auditd

- name: "MEDIUM | UBTU-18-010358 | PATCH | The Ubuntu operating system must prevent all software from executing at higher privilege levels than users executing the software and the audit system must be configured to audit the execution of privileged functions."
  debug:
      msg: "Control being set via Handler 'update auditd' which writes to /etc/audit.d/99_stig_auditd.rules"
  changed_when: true
  notify: update auditd
  when:
      - ubtu_18_010358
  tags:
      - UBTU-18-010358
      - CAT2
      - CCI-002233
      - CCI-002234
      - SRG-OS-000326-GPOS-00126
      - SV-219281r610963_rule
      - V-219281
      - auditd

- name: "MEDIUM | UBTU-18-010375 | PATCH | The Ubuntu operating system must generate audit records upon successful/unsuccessful use of unlink, unlinkat, rename, renameat, and rmdir system calls."
  debug:
      msg: "Control being set via Handler 'update auditd' which writes to /etc/audit.d/99_stig_auditd.rules"
  changed_when: true
  notify: update auditd
  when:
      - ubtu_18_010375
  tags:
      - UBTU-18-010375
      - CAT2
      - CCI-000172
      - SRG-OS-000468-GPOS-00212
      - SV-219287r809526_rule
      - V-219287
      - auditd

- name: "MEDIUM | UBTU-18-010379 | PATCH | The Ubuntu operating system must generate audit records when loading dynamic kernel modules."
  debug:
      msg: "Control being set via Handler 'update auditd' which writes to /etc/audit.d/99_stig_auditd.rules"
  changed_when: true
  notify: update auditd
  when:
      - ubtu_18_010379
  tags:
      - UBTU-18-010379
      - CAT2
      - CCI-000172
      - SRG-OS-000471-GPOS-00216
      - SV-219291r610963_rule
      - V-219291
      - auditd

- name: "MEDIUM | UBTU-18-010387 | PATCH | The Ubuntu operating system must generate records for successful/unsuccessful uses of init_module or finit_module syscalls."
  debug:
      msg: "Control being set via Handler 'update auditd' which writes to /etc/audit.d/99_stig_auditd.rules"
  changed_when: true
  notify: update auditd
  when:
      - ubtu_18_010387
  tags:
      - UBTU-18-010387
      - CAT2
      - CCI-000172
      - SRG-OS-000477-GPOS-00222
      - SV-219296r648693_rule
      - V-219296
      - auditd

- name: "MEDIUM | UBTU-18-010388 | PATCH | The Ubuntu operating system must generate records for successful/unsuccessful uses of delete_module syscall and when unloading dynamic kernel modules."
  debug:
      msg: "Control being set via Handler 'update auditd' which writes to /etc/audit.d/99_stig_auditd.rules"
  changed_when: true
  notify: update auditd
  when:
      - ubtu_18_010388
  tags:
      - UBTU-18-010388
      - CAT2
      - CCI-000172
      - SRG-OS-000477-GPOS-00222
      - SV-219297r648694_rule
      - V-219297
      - auditd

- name: "MEDIUM | UBTU-18-010389 | PATCH | The Ubuntu operating system must generate audit records when successful/unsuccessful attempts to use modprobe command."
  debug:
      msg: "Control being set via Handler 'update auditd' which writes to /etc/audit.d/99_stig_auditd.rules"
  changed_when: true
  notify: update auditd
  when:
      - ubtu_18_010389
  tags:
      - UBTU-18-010389
      - CAT2
      - CCI-000172
      - SRG-OS-000477-GPOS-00222
      - SV-219298r610963_rule
      - V-219298
      - auditd

- name: "MEDIUM | UBTU-18-010391 | PATCH | The Ubuntu operating system must generate audit records when successful/unsuccessful attempts to use the kmod command."
  debug:
      msg: "Control being set via Handler 'update auditd' which writes to /etc/audit.d/99_stig_auditd.rules"
  changed_when: true
  notify: update auditd
  when:
      - ubtu_18_010391
  tags:
      - UBTU-18-010391
      - CAT2
      - CCI-000172
      - SRG-OS-000477-GPOS-00222
      - SV-219299r610963_rule
      - V-219299
      - auditd

- name: "MEDIUM | UBTU-18-010392 | PATCH | The Ubuntu operating system must generate audit records when successful/unsuccessful attempts to use the fdisk command."

  when:
      - ubtu_18_010392
  tags:
      - UBTU-18-010392
      - CAT2
      - CCI-000172
      - SRG-OS-000477-GPOS-00222
      - SV-219300r610963_rule
      - V-219300
      - auditd
